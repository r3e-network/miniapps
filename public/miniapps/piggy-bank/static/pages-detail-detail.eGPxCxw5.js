import{A as e,j as a,b as l,q as s,Z as t,c as n,H as o,w as c,J as u,o as i,a as d,K as v,Y as r,L as f,M as _,R as k,N as m,G as p,I as h,Q as y,O as g,P as w,V as b,W as C,_ as T}from"./vue-vendor.DLq4fjsJ.js";import{s as x}from"./index-BF4KRMCJ.js";import{u as I}from"./piggy.DkTaJKTi.js";import{u as $,_ as j}from"./_plugin-vue_export-helper.CWDL7LE_.js";const D=j(e({__name:"detail",setup(e){const{t:j}=$(),D=I(),{currentChainId:V,isConnected:S}=x(D),W=a(""),A=a(""),B=a(D.getDefaultToken()),P=a(!1),E=a(null),N=a(!1),R=a(!1),H=a(!1),L=a(""),U=a(!1),q=l(()=>D.piggyBanks.find(e=>e.id===W.value)),G=l(()=>!q.value||Date.now()/1e3<q.value.unlockTime),K=l(()=>q.value?D.getBalances(W.value):{}),O=l(()=>!!q.value&&q.value.chainId!==V.value),Y=l(()=>D.getAllTokens().slice(0,6));s(V,()=>{B.value=D.getDefaultToken()}),t(e=>{e.id&&(W.value=e.id)});const Z=()=>r(),z=async()=>{if(q.value)try{await D.switchChain(q.value.chainId)}catch(e){C({title:e.message||"Switch failed",icon:"none"})}},F=async()=>{if(L.value){U.value=!0;try{const e=await D.lookupToken(L.value);e?(B.value=e,H.value=!1,L.value="",C({title:`Added ${e.symbol}`,icon:"success"})):C({title:"Invalid token address",icon:"none"})}catch(e){C({title:e.message||"Failed",icon:"none"})}finally{U.value=!1}}},J=async()=>{P.value=!0,E.value=null;try{const e=await D.checkGoalReached(W.value);E.value=e}finally{P.value=!1}},M=async()=>{if(A.value&&q.value&&B.value){N.value=!0;try{if(!(await new Promise(e=>{T({title:"‚ö†Ô∏è Important",content:`Depositing ${A.value} ${B.value.symbol}. Your note has been saved locally. If you clear app data, you will lose access to these funds forever!`,confirmText:"I Understand",success:a=>e(Boolean(a.confirm)),fail:()=>e(!1)})})))return;S.value||await D.connectWallet(),await D.sendDeposit(W.value,A.value,B.value),C({title:j("detail.deposit_success"),icon:"success"}),A.value="",E.value=null}catch(e){C({title:e.message||"Error",icon:"none"})}finally{N.value=!1}}},Q=async()=>{if(q.value){R.value=!0;try{const e=D.previewWithdrawals(W.value);if(0===e.length)return void C({title:"No confirmed deposits to withdraw",icon:"none"});const a=e.map(e=>`${e.amount} ${e.token.symbol}`).join("\n");if(!(await new Promise(e=>{T({title:"üî® Smash Piggy Bank!",content:`Withdrawing:\n${a}\n\nThis will send ZK proofs to the contract.`,success:a=>e(Boolean(a.confirm)),fail:()=>e(!1)})})))return;S.value||await D.connectWallet(),await D.withdraw(W.value),C({title:j("detail.smash_success"),icon:"success"})}catch(e){C({title:e.message,icon:"none"})}finally{R.value=!1}}};return(e,a)=>{const l=v,s=u,t=g,r=b;return q.value?(i(),n(s,{key:0,class:"container"},{default:c(()=>[d(s,{class:"nav"},{default:c(()=>[d(l,{class:"back-btn",onClick:Z},{default:c(()=>[f("‚Üê")]),_:1}),d(l,{class:"page-title"},{default:c(()=>[f(_(q.value.name),1)]),_:1})]),_:1}),d(s,{class:"hero-card",style:k({borderColor:q.value.themeColor,boxShadow:`0 0 20px ${q.value.themeColor}30`})},{default:c(()=>[d(s,{class:"lock-icon"},{default:c(()=>[f(_(G.value?"üîí":"üîì"),1)]),_:1}),d(l,{class:"status-text"},{default:c(()=>[f(_(G.value?m(j)("detail.locked"):m(j)("detail.unlocked")),1)]),_:1}),G.value?(i(),n(s,{key:0,class:"balance-hidden"},{default:c(()=>[d(l,{class:"hidden-label"},{default:c(()=>[f(_(m(j)("detail.balance_hidden")),1)]),_:1}),d(s,{class:"dots"},{default:c(()=>[d(s,{class:"dot"}),d(s,{class:"dot"}),d(s,{class:"dot"})]),_:1})]),_:1})):(i(),n(s,{key:1,class:"balance-revealed"},{default:c(()=>[(i(!0),p(h,null,y(K.value,(e,a)=>(i(),n(s,{key:a,class:"balance-row"},{default:c(()=>[d(l,{class:"token-icon"},{default:c(()=>[f(_(e.token.icon),1)]),_:2},1024),d(l,{class:"token-balance"},{default:c(()=>[f(_(e.amount)+" "+_(e.token.symbol),1)]),_:2},1024)]),_:2},1024))),128)),0===Object.keys(K.value).length?(i(),n(l,{key:0,class:"empty-balance"},{default:c(()=>[f("No deposits")]),_:1})):o("",!0)]),_:1})),d(l,{class:"unlock-date"},{default:c(()=>[f(_(m(j)("detail.unlocks_on",{date:new Date(1e3*q.value.unlockTime).toLocaleDateString()})),1)]),_:1})]),_:1},8,["style"]),d(s,{class:"section"},{default:c(()=>[d(s,{class:"section-header"},{default:c(()=>[d(l,{class:"section-title"},{default:c(()=>[f(_(m(j)("detail.goal"))+": "+_(q.value.targetAmount)+" "+_(q.value.targetToken.symbol),1)]),_:1}),d(t,{class:"zk-btn",onClick:J,loading:P.value},{default:c(()=>[f(_(P.value?"...":m(j)("detail.check_goal")),1)]),_:1},8,["loading"])]),_:1}),null!==E.value?(i(),n(s,{key:0,class:w(["goal-feedback",{success:E.value}])},{default:c(()=>[f(_(E.value?m(j)("detail.goal_reached"):m(j)("detail.goal_not_reached")),1)]),_:1},8,["class"])):o("",!0)]),_:1}),O.value?(i(),n(s,{key:0,class:"section"},{default:c(()=>[d(s,{class:"warning-card"},{default:c(()=>[d(l,{class:"warning-text"},{default:c(()=>[f(_(m(j)("wallet.wrong_network")),1)]),_:1}),d(t,{class:"switch-btn",onClick:z},{default:c(()=>[f(_(m(j)("wallet.switch_network")),1)]),_:1})]),_:1})]),_:1})):o("",!0),G.value?(i(),n(s,{key:1,class:"section deposit-section"},{default:c(()=>[d(l,{class:"section-title"},{default:c(()=>[f(_(m(j)("detail.deposit")),1)]),_:1}),d(s,{class:"token-selector"},{default:c(()=>[(i(!0),p(h,null,y(Y.value,e=>{var a;return i(),n(s,{key:e.address,class:w(["token-option",{active:(null==(a=B.value)?void 0:a.address)===e.address}]),onClick:a=>B.value=e},{default:c(()=>[d(l,{class:"token-icon"},{default:c(()=>[f(_(e.icon),1)]),_:2},1024),d(l,{class:"token-name"},{default:c(()=>[f(_(e.symbol),1)]),_:2},1024)]),_:2},1032,["class","onClick"])}),128)),d(s,{class:"token-option add-token",onClick:a[0]||(a[0]=e=>H.value=!0)},{default:c(()=>[d(l,{class:"add-icon"},{default:c(()=>[f("+")]),_:1})]),_:1})]),_:1}),H.value?(i(),n(s,{key:0,class:"custom-token-input"},{default:c(()=>[d(r,{class:"address-input",modelValue:L.value,"onUpdate:modelValue":a[1]||(a[1]=e=>L.value=e),placeholder:"Enter any ERC-20 token address (0x...)","placeholder-class":"placeholder"},null,8,["modelValue"]),d(s,{class:"btn-row"},{default:c(()=>[d(t,{class:"cancel-btn",onClick:a[2]||(a[2]=e=>H.value=!1)},{default:c(()=>[f("Cancel")]),_:1}),d(t,{class:"add-btn",onClick:F,disabled:U.value},{default:c(()=>[f(_(U.value?"Loading...":"Add Token"),1)]),_:1},8,["disabled"])]),_:1})]),_:1})):o("",!0),d(s,{class:"input-row"},{default:c(()=>{var e;return[d(r,{class:"amount-input",type:"digit",modelValue:A.value,"onUpdate:modelValue":a[3]||(a[3]=e=>A.value=e),placeholder:`0.0 ${(null==(e=B.value)?void 0:e.symbol)||""}`},null,8,["modelValue","placeholder"]),d(t,{class:"deposit-btn",onClick:M,disabled:!A.value||!B.value||N.value},{default:c(()=>[f(_(N.value?m(j)("common.loading"):m(j)("detail.deposit")),1)]),_:1},8,["disabled"])]}),_:1}),B.value&&!B.value.isNative?(i(),n(l,{key:1,class:"deposit-hint"},{default:c(()=>[f(" ‚ö†Ô∏è ERC-20 tokens require approval before deposit ")]),_:1})):o("",!0)]),_:1})):o("",!0),G.value?o("",!0):(i(),n(s,{key:2,class:"section smash-section"},{default:c(()=>[d(t,{class:"smash-btn",onClick:Q,disabled:R.value},{default:c(()=>[f(_(R.value?m(j)("common.loading"):`üî® ${m(j)("detail.smash")}`),1)]),_:1},8,["disabled"])]),_:1})),q.value.notes.length>0?(i(),n(s,{key:3,class:"section history-section"},{default:c(()=>[d(l,{class:"section-title"},{default:c(()=>[f(_(m(j)("detail.deposits"))+" ("+_(q.value.notes.length)+")",1)]),_:1}),d(s,{class:"note-list"},{default:c(()=>[(i(!0),p(h,null,y(q.value.notes,(e,a)=>(i(),n(s,{key:a,class:"note-item"},{default:c(()=>[d(s,{class:"note-info"},{default:c(()=>[d(s,{class:"note-token"},{default:c(()=>[d(l,{class:"note-icon"},{default:c(()=>[f(_(e.token.icon),1)]),_:2},1024),d(l,{class:"note-amount"},{default:c(()=>[f(_(e.amount)+" "+_(e.token.symbol),1)]),_:2},1024)]),_:2},1024),d(l,{class:w(["note-status",{confirmed:e.depositTxHash,spent:e.isSpent}])},{default:c(()=>[f(_(e.isSpent?"‚úì Withdrawn":e.depositTxHash?"‚úì Confirmed":"‚è≥ Pending"),1)]),_:2},1032,["class"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})):o("",!0)]),_:1})):o("",!0)}}}),[["__scopeId","data-v-ed12b7a6"]]);export{D as default};
