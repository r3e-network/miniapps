import{b as e,m as t,K as a,L as s,l,c as i,w as o,p as n,o as c,a as r,q as u,t as d,x as v,y as _,v as f,B as p,M as m}from"./vue-vendor.BIaJ2O32.js";import{u as g,_ as b}from"./NeoDoc.vue_vue_type_style_index_0_scoped_eb223f14_lang.D0joGKA1.js";import{a as y,N as h,A as x}from"./Fireworks.vue_vue_type_style_index_0_scoped_b6ed5fc5_lang.BkKeoILt.js";import"./index-CsmXwgKF.js";const A=b(e({__name:"index",setup(e){const{t:b,locale:A}=g(),j=t(""),k=t(!0),S=t(!1),C=t(null);function w(){m()}function N(e){try{return decodeURIComponent(escape(atob(e)))}catch{return e}}function D(e){return String(e||"").toLowerCase()}function U(e){return Number.isFinite(e)?e.toLocaleString():"0"}function I(e){if(!e)return"";const t=new Date(e);if(Number.isNaN(t.getTime()))return"";const a="zh"===A.value?"zh-CN":"en-US";return t.toLocaleDateString(a,{month:"long",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"})}function R(e){console.log(e)}return t(""),a(e=>{if(e&&e.id){j.value=e.id;try{const t=s("current_grant_detail");if(t&&String(t.id)===String(e.id))return C.value=t,void(k.value=!1)}catch(t){console.error("Storage read error",t)}!async function(e){k.value=!0,S.value=!1;try{const t=await new Promise((t,a)=>{l({url:`/api/grantshares/proposal?id=${e}`,success:e=>t(e.data),fail:e=>a(e)})});if(t){const e=t;C.value={id:String(e.offchain_id||e.id||""),title:N(e.title||""),description:N(e.description||""),proposer:String(e.proposer||e.proposer_address||e.proposerAddress||""),state:D(e.state||""),votesAccept:Number(e.votes_amount_accept||e.votesAmountAccept||0),votesReject:Number(e.votes_amount_reject||e.votesAmountReject||0),discussionUrl:String(e.discussion_url||e.discussionUrl||""),createdAt:String(e.offchain_creation_timestamp||e.offchainCreationTimestamp||""),onchainId:e.onchain_id??e.onchainId??null}}else S.value=!0}catch(t){console.error(t),S.value=!0}finally{k.value=!1}}(e.id)}else S.value=!0,k.value=!1}),(e,t)=>{const a=u,s=f;return c(),i(n(x),{class:"theme-grant-share"},{default:o(()=>[r(a,{class:"app-container"},{default:o(()=>[r(a,{class:"nav-header mb-4"},{default:o(()=>[r(n(y),{size:"sm",variant:"secondary",onClick:w},{default:o(()=>[v(" â† "+_(n(b)("back")),1)]),_:1})]),_:1}),k.value?(c(),i(a,{key:0,class:"empty-state"},{default:o(()=>[r(s,{class:"empty-text"},{default:o(()=>[v(_(n(b)("loading")),1)]),_:1})]),_:1})):S.value?(c(),i(a,{key:1,class:"empty-state"},{default:o(()=>[r(s,{class:"empty-text"},{default:o(()=>[v(_(n(b)("loadFailed")),1)]),_:1})]),_:1})):C.value?(c(),i(a,{key:2,class:"grant-detail"},{default:o(()=>[r(n(h),{variant:"erobo-neo",class:"mb-4"},{default:o(()=>[r(a,{class:"header-section"},{default:o(()=>[r(s,{class:"grant-title-glass"},{default:o(()=>[v(_(C.value.title),1)]),_:1}),r(a,{class:"meta-row mt-2"},{default:o(()=>[r(s,{class:"grant-creator-glass"},{default:o(()=>[v(_(n(b)("by"))+" "+_(C.value.proposer),1)]),_:1}),r(a,{class:p(["grant-badge-glass",C.value.state])},{default:o(()=>[r(s,{class:"badge-text"},{default:o(()=>{return[v(_((e=C.value.state,{active:b("statusActive"),review:b("statusReview"),voting:b("statusVoting"),discussion:b("statusDiscussion"),executed:b("statusExecuted"),cancelled:b("statusCancelled"),rejected:b("statusRejected"),expired:b("statusExpired")}[D(e)]||e)),1)];var e}),_:1})]),_:1},8,["class"])]),_:1}),r(a,{class:"proposal-meta mt-2"},{default:o(()=>[null!==C.value.onchainId?(c(),i(s,{key:0,class:"meta-item"},{default:o(()=>[v("#"+_(C.value.onchainId),1)]),_:1})):d("",!0),C.value.createdAt?(c(),i(s,{key:1,class:"meta-item"},{default:o(()=>[v(_(I(C.value.createdAt)),1)]),_:1})):d("",!0)]),_:1})]),_:1})]),_:1}),r(n(h),{variant:"erobo-neo",class:"mb-4"},{default:o(()=>[r(a,{class:"section-title-glass"},{default:o(()=>[v(_(n(b)("details")),1)]),_:1}),r(a,{class:"description-content"},{default:o(()=>[r(s,{class:"desc-text"},{default:o(()=>[v(_(C.value.description||n(b)("noDescription")),1)]),_:1})]),_:1})]),_:1}),r(n(h),{variant:"erobo-neo",class:"mb-4"},{default:o(()=>[r(a,{class:"section-title-glass"},{default:o(()=>[v(_(n(b)("voting")),1)]),_:1}),r(a,{class:"proposal-stats"},{default:o(()=>[r(a,{class:"stat-chip accept"},{default:o(()=>[v(_(n(b)("votesFor"))+" "+_(U(C.value.votesAccept)),1)]),_:1}),r(a,{class:"stat-chip reject"},{default:o(()=>[v(_(n(b)("votesAgainst"))+" "+_(U(C.value.votesReject)),1)]),_:1})]),_:1}),r(a,{class:"mt-4 flex gap-2"},{default:o(()=>[r(n(y),{size:"sm",variant:"secondary",disabled:!C.value.discussionUrl,onClick:t[0]||(t[0]=e=>function(e){if(!e)return;const t=null==globalThis?void 0:globalThis.uni;(null==t?void 0:t.setClipboardData)&&t.setClipboardData({data:e,success:()=>R(b("linkCopied")),fail:()=>R(b("copyFailed"))})}(C.value.discussionUrl))},{default:o(()=>[v(_(C.value.discussionUrl?n(b)("discussionLink"):n(b)("noDiscussion")),1)]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1})):d("",!0)]),_:1})]),_:1})}}}),[["__scopeId","data-v-a5ef1520"]]);export{A as default};
