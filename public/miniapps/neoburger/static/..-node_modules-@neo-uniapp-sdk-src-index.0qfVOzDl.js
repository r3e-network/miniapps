import{w as e,a,b as t}from"./index.CH9RT4ck.js";import{f as n,e as s,c as o,g as r,d as i,i as l,r as c,s as d,h as u,u as p}from"./index.CH9RT4ck.js";import{m as v,e as f,b as m,n as g,f as h,c as w,o as _,w as y,a as S,p as b,y as k,z as M,A as x,x as D,K as I,L as E,q as L,Q as N,t as A,F as C,v as T,B as K}from"./vue-vendor._Ji6rutF.js";import{_ as P}from"./NeoDoc.C0kNRWcD.js";import"./index-C8svGWOQ.js";function F(e){const a=v(!1),t=v(null);return{isLoading:a,error:t,execute:async(...n)=>{a.value=!0,t.value=null;try{return await e(...n)}catch(s){throw t.value=s,s}finally{a.value=!1}}}}function G(a){const{isLoading:t,error:n,execute:s}=F(async(t,n)=>{const s=parseFloat(t);if(Number.isNaN(s)||s<=0)throw new Error("Invalid amount: must be a positive number");const o=await e();return o.payments.payGASAndInvoke?await o.payments.payGASAndInvoke(a,t,n):await o.payments.payGAS(a,t,n)});return{isLoading:t,error:n,payGAS:s}}function q(a){const t=F(async(t,n,s)=>{if(!t||"string"!=typeof t)throw new Error("Invalid proposalId: must be a non-empty string");const o=parseFloat(n);if(Number.isNaN(o)||o<=0)throw new Error("Invalid amount: must be a positive number");const r=await e();return await r.governance.vote(a,t,n,s)}),n=F(async()=>{const a=await e();return await a.governance.getCandidates()});return{isVoting:t.isLoading,voteError:t.error,vote:t.execute,isLoadingCandidates:n.isLoading,candidatesError:n.error,getCandidates:n.execute}}function j(a){if(!a||"string"!=typeof a)throw new Error("useRNG: appId is required and must be a non-empty string");const{isLoading:t,error:n,execute:s}=F(async()=>{const t=await e();return await t.rng.requestRandom(a)});return{isLoading:t,error:n,requestRandom:s}}function R(){const a=F(async a=>{if(!a||"string"!=typeof a)throw new Error("getPrice: symbol is required and must be a non-empty string");const t=await e();return await t.datafeed.getPrice(a)}),t=F(async()=>{var a;const t=await e();if(!(null==(a=t.datafeed)?void 0:a.getPrices))throw new Error("datafeed.getPrices not available");return await t.datafeed.getPrices()}),n=F(async()=>{var a;const t=await e();if(!(null==(a=t.datafeed)?void 0:a.getNetworkStats))throw new Error("datafeed.getNetworkStats not available");return await t.datafeed.getNetworkStats()}),s=F(async a=>{var t;const n=await e();if(!(null==(t=n.datafeed)?void 0:t.getRecentTransactions))throw new Error("datafeed.getRecentTransactions not available");return await n.datafeed.getRecentTransactions(a)});return{isLoading:a.isLoading,error:a.error,getPrice:a.execute,isLoadingPrices:t.isLoading,pricesError:t.error,getPrices:t.execute,isLoadingNetworkStats:n.isLoading,networkStatsError:n.error,getNetworkStats:n.execute,isLoadingRecentTransactions:s.isLoading,recentTransactionsError:s.error,getRecentTransactions:s.execute}}function B(){const a=F(async(a={})=>{var t;const n=await e();if(!(null==(t=n.events)?void 0:t.list))throw new Error("events.list not available");return await n.events.list(a)}),t=F(async(a,t)=>{var n;const s=String(a||"").trim();if(!s)throw new Error("eventName required");const o=await e();if(!(null==(n=o.events)?void 0:n.emit))throw new Error("events.emit not available");return await o.events.emit(s,t||{})});return{isLoading:a.isLoading,error:a.error,list:a.execute,isEmitting:t.isLoading,emitError:t.error,emit:t.execute}}function O(){const e=F(async()=>t("/gas-sponsor-check")),n=F(async e=>{const t=parseFloat(e);if(Number.isNaN(t)||t<=0)throw new Error("Invalid amount: must be a positive number");return a("/gas-sponsor-request",{amount:e})});return{isCheckingEligibility:e.isLoading,eligibilityError:e.error,checkEligibility:e.execute,isRequestingSponsorship:n.isLoading,sponsorshipError:n.error,requestSponsorship:n.execute}}function V(a={}){const{slot:t="default",autoLoad:n=!1}=a,s=v([]),o=v(null),r=v(!1),i=v(!1),l=v(!1),c=v(null),d=v(null),u=async a=>{var n;r.value=!0,c.value=null;try{const r=await e(),i=await r.wallet.getAddress(),l=(null==(n=r.getConfig)?void 0:n.call(r).appId)||"unknown",c=await fetch(`/api/miniapps/${l}/cloud-saves`,{headers:{"x-wallet-address":i}});if(!c.ok)throw new Error("Failed to load saves");const u=await c.json();s.value=u.saves||[];const p=a||t;return o.value=s.value.find(e=>e.slot_name===p)||null,d.value=new Date,o.value}catch(i){return c.value=i,null}finally{r.value=!1}};return f(()=>{n&&u()}),{saves:s,currentSave:o,isLoading:r,isSaving:i,isDeleting:l,error:c,lastSyncedAt:d,load:u,save:async(a,n)=>{var s;i.value=!0,c.value=null;try{const r=await e(),i=await r.wallet.getAddress(),l=(null==(s=r.getConfig)?void 0:s.call(r).appId)||"unknown",c=await fetch(`/api/miniapps/${l}/cloud-saves`,{method:"PUT",headers:{"Content-Type":"application/json","x-wallet-address":i},body:JSON.stringify({slot_name:n||t,save_data:a,client_timestamp:(new Date).toISOString()})});if(!c.ok)throw new Error("Failed to save");const u=await c.json();return o.value=u.save,d.value=new Date,!0}catch(r){return c.value=r,!1}finally{i.value=!1}},deleteSave:async a=>{var n,r;l.value=!0,c.value=null;try{const i=await e(),l=await i.wallet.getAddress(),c=(null==(n=i.getConfig)?void 0:n.call(i).appId)||"unknown";if(!(await fetch(`/api/miniapps/${c}/cloud-saves`,{method:"DELETE",headers:{"Content-Type":"application/json","x-wallet-address":l},body:JSON.stringify({slot_name:a||t})})).ok)throw new Error("Failed to delete");return s.value=s.value.filter(e=>e.slot_name!==(a||t)),(null==(r=o.value)?void 0:r.slot_name)===(a||t)&&(o.value=null),!0}catch(i){return c.value=i,!1}finally{l.value=!1}}}}const U=()=>`mock-${Date.now()}-${Math.random().toString(36).slice(2,8)}`,$={invoke:async(e,...a)=>(console.log("[MockSDK] invoke:",e,a),{}),getConfig:()=>({appId:"mock-app",contractAddress:null,debug:!0}),wallet:{getAddress:async()=>(console.log("[MockSDK] getAddress called"),"NXV7ZhHiyM1aHXwpVsRZC6BwNFP2jghXAq"),async switchChain(e){console.log("[MockSDK] switchChain called:",e)},async signMessage(e){return console.log("[MockSDK] signMessage:",e),`mock-signature-${(a=e,"function"==typeof btoa?btoa(a):"undefined"!=typeof Buffer?Buffer.from(a,"utf8").toString("base64"):a).slice(0,12)}`;var a},invokeIntent:async e=>(console.log("[MockSDK] invokeIntent:",e),{txid:U()})},payments:{async payGAS(e,a,t){console.log("[MockSDK] payGAS:",{appId:e,amount:a,memo:t}),await new Promise(e=>setTimeout(e,800));const n=U();return{request_id:n,receipt_id:n,user_id:"mock-user",intent:"payments",constraints:{settlement:"GAS_ONLY"},chain_id:"neo-n3-mainnet",chain_type:"neo-n3",invocation:{chain_id:"neo-n3-mainnet",chain_type:"neo-n3",contract_address:"0x0bb8f09e6d3611bc5c8adbd79ff8af1e34f73193",method:"transfer",params:[a,t??""]}}},async payGASAndInvoke(e,a,t){return{...await this.payGAS(e,a,t),txid:U()}}},governance:{vote:async(e,a,t,n)=>(console.log("[MockSDK] vote:",{appId:e,proposalId:a,amount:t,support:n}),await new Promise(e=>setTimeout(e,800)),{request_id:U(),user_id:"mock-user",intent:"governance",constraints:{governance:"BNEO_ONLY"},chain_id:"neo-n3-mainnet",chain_type:"neo-n3",invocation:{chain_id:"neo-n3-mainnet",chain_type:"neo-n3",contract_address:"0xc8f3bbe1c205c932aab00b28f7df99f9bc788a05",method:"vote",params:[a,t,n]}}),async voteAndInvoke(e,a,t,n){return{...await this.vote(e,a,t,n),txid:U()}},getCandidates:async()=>(console.log("[MockSDK] getCandidates called"),await new Promise(e=>setTimeout(e,500)),{candidates:[{address:"NNShaEBGVBfmGWzGs6W5sCneKPBwmCA3Br",publicKey:"02a1",name:"NeoEconoLabs",votes:"5000000",active:!0},{address:"NdUL5oDPD159KeFpD5A9zw5xNF1xLX6nLT",publicKey:"03b2",name:"COZ",votes:"4500000",active:!0},{address:"NKuyBkoGdZZSLyPbJEetheRhMjeznFZszf",publicKey:"02c3",name:"AxLabs",votes:"3200000",active:!0}],totalVotes:"12700000",blockHeight:1234567})},rng:{async requestRandom(e){console.log("[MockSDK] requestRandom:",e),await new Promise(e=>setTimeout(e,500));const a=Array.from({length:32},()=>Math.floor(256*Math.random()).toString(16).padStart(2,"0")).join("");return{request_id:U(),app_id:e,chain_id:"neo-n3-mainnet",chain_type:"neo-n3",randomness:a}}},datafeed:{async getPrice(e){console.log("[MockSDK] getPrice:",e);return{feed_id:U(),pair:e,price:{"NEO-USD":"12.45","GAS-USD":"4.32","BTC-USD":"43250.00","ETH-USD":"2280.50"}[e]||"100.00",decimals:8,timestamp:(new Date).toISOString(),sources:["mock"]}},getPrices:async()=>(console.log("[MockSDK] getPrices called"),{neo:{usd:12.45,usd_24h_change:1.2},gas:{usd:4.32,usd_24h_change:-.4},timestamp:Date.now()}),getNetworkStats:async()=>(console.log("[MockSDK] getNetworkStats called"),{blockHeight:1234567,validatorCount:7,network:"neo-n3-mainnet",version:"mock-1.0"}),async getRecentTransactions(e=10){console.log("[MockSDK] getRecentTransactions called:",e);const a=Math.max(1,Math.min(e,5));return{blockHeight:1234567,transactions:Array.from({length:a},()=>({txid:U(),blockHeight:1234567,blockTime:Date.now(),sender:"NQiQvS9s5XbPpKXt9g6z4yUaqE8h4PGnRy",size:123,sysfee:"0.1",netfee:"0.01"}))}}},events:{async list(e={}){console.log("[MockSDK] events.list:",e),await new Promise(e=>setTimeout(e,300));const a=U();return{events:[{id:a,app_id:e.app_id||"mock-app",event_name:e.event_name||"MockEvent",chain_id:e.chain_id||"neo-n3-mainnet",contract_address:"0x0000000000000000000000000000000000000000",tx_hash:`0x${U()}`,block_index:1234567,state:[],created_at:(new Date).toISOString()}],has_more:!1,last_id:a}}},transactions:{async list(e={}){console.log("[MockSDK] transactions.list:",e),await new Promise(e=>setTimeout(e,300));const a=U();return{transactions:[{id:a,tx_hash:`0x${a}`,request_id:U(),from_service:"mock",tx_type:"contract",chain_id:e.chain_id||"neo-n3-mainnet",contract_address:"0x0000000000000000000000000000000000000000",method_name:"transfer",params:{},gas_consumed:.1,status:"confirmed",retry_count:0,error_message:null,rpc_endpoint:null,submitted_at:(new Date).toISOString(),confirmed_at:(new Date).toISOString()}],has_more:!1,last_id:a}}},stats:{getMyUsage:async(e,a)=>(console.log("[MockSDK] stats.getMyUsage:",{appId:e,date:a}),await new Promise(e=>setTimeout(e,300)),{app_id:e,chain_id:"neo-n3-mainnet",date:a||(new Date).toISOString().split("T")[0],transactions:42,volume_gas:"123.45",unique_users:10})}};function z(){"undefined"!=typeof window&&(window.MiniAppSDK=$,console.log("[MockSDK] Installed on window.MiniAppSDK"),window.dispatchEvent(new Event("miniapp-sdk-ready")))}function H(){const e=Date.now()+36e5+72e5*Math.random();return{type:"live_countdown",refreshInterval:1,endTime:Math.floor(e/1e3),jackpot:(1e3+9e3*Math.random()).toFixed(2),ticketsSold:Math.floor(100+500*Math.random()),ticketPrice:"0.1"}}function W(){return{type:"live_multiplier",refreshInterval:.1,currentMultiplier:1+5*Math.random(),status:["waiting","running","crashed"][Math.floor(3*Math.random())],playersCount:Math.floor(10+50*Math.random()),totalBets:(100+900*Math.random()).toFixed(2)}}function X(){return{type:"live_canvas",refreshInterval:5,pixels:Z(32,32),width:32,height:32,activeUsers:Math.floor(5+20*Math.random())}}function Z(e,a){const t=["#10b981","#3b82f6","#ec4899","#f59e0b","#8b5cf6"];let n="";for(let s=0;s<e*a;s++)n+=t[Math.floor(Math.random()*t.length)].slice(1);return n}function J(){return{type:"live_stats",refreshInterval:10,stats:[{label:"Available",value:String(Math.floor(5+20*Math.random())),icon:"ðŸ§§"},{label:"Total GAS",value:(50+200*Math.random()).toFixed(1),change:12.5},{label:"Claimed",value:String(Math.floor(100+500*Math.random()))}]}}function Q(){const e=Math.floor(1e3+5e3*Math.random()),a=Math.floor(e*(.3+.5*Math.random()));return{type:"live_voting",refreshInterval:30,proposalTitle:"Increase staking rewards",yesVotes:a,noVotes:e-a,totalVotes:e,endTime:Math.floor((Date.now()+2592e5)/1e3)}}function Y(){const e=10+5*Math.random();return{type:"live_price",refreshInterval:5,symbol:"NEO-USD",price:e.toFixed(2),change24h:10*Math.random()-5,sparkline:Array.from({length:24},()=>e*(.95+.1*Math.random()))}}const ee=P(m({__name:"CardCountdown",props:{data:{}},setup(e){const a=e,t=v(Math.floor(Date.now()/1e3));let n;const s=g(()=>Math.max(0,a.data.endTime-t.value)),o=g(()=>String(Math.floor(s.value/3600)).padStart(2,"0")),r=g(()=>String(Math.floor(s.value%3600/60)).padStart(2,"0")),i=g(()=>String(s.value%60).padStart(2,"0")),l=g(()=>a.data.jackpot),c=g(()=>a.data.ticketsSold);return f(()=>{n=setInterval(()=>{t.value=Math.floor(Date.now()/1e3)},1e3)}),h(()=>clearInterval(n)),(e,a)=>{const t=k,n=b;return _(),w(n,{class:"card-countdown"},{default:y(()=>[S(n,{class:"countdown-timer"},{default:y(()=>[S(t,{class:"time-value"},{default:y(()=>[M(x(o.value),1)]),_:1}),S(t,{class:"time-sep"},{default:y(()=>[M(":")]),_:1}),S(t,{class:"time-value"},{default:y(()=>[M(x(r.value),1)]),_:1}),S(t,{class:"time-sep"},{default:y(()=>[M(":")]),_:1}),S(t,{class:"time-value"},{default:y(()=>[M(x(i.value),1)]),_:1})]),_:1}),S(n,{class:"jackpot"},{default:y(()=>[S(t,{class:"jackpot-label"},{default:y(()=>[M("Jackpot")]),_:1}),S(t,{class:"jackpot-value"},{default:y(()=>[M(x(l.value)+" GAS",1)]),_:1})]),_:1}),S(n,{class:"tickets"},{default:y(()=>[S(t,null,{default:y(()=>[M(x(c.value)+" tickets sold",1)]),_:1})]),_:1})]),_:1})}}}),[["__scopeId","data-v-cb3ef45a"]]),ae=P(m({__name:"CardMultiplier",props:{data:{}},setup(e){const a=e,t=g(()=>a.data.currentMultiplier.toFixed(2)),n=g(()=>({waiting:"Starting...",running:"LIVE",crashed:"Crashed!"}[a.data.status]));return(e,a)=>{const s=k,o=b;return _(),w(o,{class:D(["card-multiplier",e.data.status])},{default:y(()=>[S(o,{class:"multiplier-display"},{default:y(()=>[S(s,{class:"multiplier-value"},{default:y(()=>[M(x(t.value)+"x",1)]),_:1}),S(s,{class:"status-badge"},{default:y(()=>[M(x(n.value),1)]),_:1})]),_:1}),S(o,{class:"game-info"},{default:y(()=>[S(s,null,{default:y(()=>[M(x(e.data.playersCount)+" players",1)]),_:1}),S(s,null,{default:y(()=>[M(x(e.data.totalBets)+" GAS",1)]),_:1})]),_:1})]),_:1},8,["class"])}}}),[["__scopeId","data-v-4d4c6070"]]),te=P(m({__name:"CardCanvas",props:{data:{}},setup(e){const a=e,t=v(120);function n(){const e=N("preview-canvas"),{pixels:n,width:s,height:o}=a.data,r=t.value/s;for(let a=0;a<n.length/6;a++){const t="#"+n.slice(6*a,6*a+6),o=a%s*r,i=Math.floor(a/s)*r;e.setFillStyle(t),e.fillRect(o,i,r,r)}e.draw()}return f(()=>n()),I(()=>a.data.pixels,n),(e,a)=>{const n=E,s=b,o=k;return _(),w(s,{class:"card-canvas"},{default:y(()=>[S(s,{class:"canvas-preview"},{default:y(()=>[S(n,{"canvas-id":"preview-canvas",class:"preview-canvas",style:L({width:t.value+"px",height:t.value+"px"})},null,8,["style"])]),_:1}),S(s,{class:"canvas-info"},{default:y(()=>[S(o,{class:"active-users"},{default:y(()=>[M("ðŸŽ¨ "+x(e.data.activeUsers)+" active",1)]),_:1}),S(o,{class:"canvas-size"},{default:y(()=>[M(x(e.data.width)+"Ã—"+x(e.data.height),1)]),_:1})]),_:1})]),_:1})}}}),[["__scopeId","data-v-85b6f59e"]]),ne=P(m({__name:"CardStats",props:{data:{}},setup:e=>(e,a)=>{const t=k,n=b;return _(),w(n,{class:"card-stats"},{default:y(()=>[(_(!0),A(C,null,T(e.data.stats,(e,a)=>(_(),w(n,{key:a,class:"stat-item"},{default:y(()=>[e.icon?(_(),w(t,{key:0,class:"stat-icon"},{default:y(()=>[M(x(e.icon),1)]),_:2},1024)):K("",!0),S(n,{class:"stat-content"},{default:y(()=>[S(t,{class:"stat-value"},{default:y(()=>[M(x(e.value),1)]),_:2},1024),S(t,{class:"stat-label"},{default:y(()=>[M(x(e.label),1)]),_:2},1024)]),_:2},1024),e.change?(_(),w(t,{key:1,class:D(["stat-change",e.change>0?"up":"down"])},{default:y(()=>[M(x(e.change>0?"+":"")+x(e.change.toFixed(1))+"% ",1)]),_:2},1032,["class"])):K("",!0)]),_:2},1024))),128))]),_:1})}}),[["__scopeId","data-v-c3e3c1b2"]]),se=P(m({__name:"CardVoting",props:{data:{}},setup(e){const a=e,t=g(()=>Math.round(a.data.yesVotes/a.data.totalVotes*100)),n=g(()=>100-t.value),s=g(()=>{const e=a.data.endTime-Math.floor(Date.now()/1e3);if(e<=0)return"Ended";const t=Math.floor(e/86400);return t>0?`${t}d left`:`${Math.floor(e/3600)}h left`});return(e,a)=>{const o=k,r=b;return _(),w(r,{class:"card-voting"},{default:y(()=>[S(o,{class:"proposal-title"},{default:y(()=>[M(x(e.data.proposalTitle),1)]),_:1}),S(r,{class:"vote-bars"},{default:y(()=>[S(r,{class:"vote-bar yes"},{default:y(()=>[S(r,{class:"bar-fill",style:L({width:t.value+"%"})},null,8,["style"]),S(o,{class:"bar-label"},{default:y(()=>[M("Yes "+x(t.value)+"%",1)]),_:1})]),_:1}),S(r,{class:"vote-bar no"},{default:y(()=>[S(r,{class:"bar-fill",style:L({width:n.value+"%"})},null,8,["style"]),S(o,{class:"bar-label"},{default:y(()=>[M("No "+x(n.value)+"%",1)]),_:1})]),_:1})]),_:1}),S(r,{class:"vote-footer"},{default:y(()=>[S(o,null,{default:y(()=>[M(x(e.data.totalVotes)+" votes",1)]),_:1}),S(o,null,{default:y(()=>[M(x(s.value),1)]),_:1})]),_:1})]),_:1})}}}),[["__scopeId","data-v-ae1a2b5a"]]),oe=P(m({__name:"CardPrice",props:{data:{}},setup(e){const a=e,t=g(()=>{const{sparkline:e}=a.data,t=Math.min(...e),n=Math.max(...e)-t||1;return e.map(e=>20+(e-t)/n*80)});return(e,a)=>{const n=k,s=b;return _(),w(s,{class:"card-price"},{default:y(()=>[S(s,{class:"price-header"},{default:y(()=>[S(n,{class:"symbol"},{default:y(()=>[M(x(e.data.symbol),1)]),_:1}),S(n,{class:D(["change",e.data.change24h>=0?"up":"down"])},{default:y(()=>[M(x(e.data.change24h>=0?"+":"")+x(e.data.change24h.toFixed(2))+"% ",1)]),_:1},8,["class"])]),_:1}),S(n,{class:"price-value"},{default:y(()=>[M("$"+x(e.data.price),1)]),_:1}),S(s,{class:"sparkline"},{default:y(()=>[(_(!0),A(C,null,T(t.value,(a,t)=>(_(),w(s,{key:t,class:D(["spark-bar",e.data.change24h>=0?"up":"down"]),style:L({height:a+"%"})},null,8,["style","class"]))),128))]),_:1})]),_:1})}}}),[["__scopeId","data-v-4bc5fda9"]]);export{te as CardCanvas,ee as CardCountdown,ae as CardMultiplier,oe as CardPrice,ne as CardStats,se as CardVoting,n as callBridge,s as cleanupWalletStateListener,o as createH5Bridge,r as getSDKSync,i as getWalletState,l as initWalletStateListener,z as installMockSDK,X as mockCanvasData,H as mockCountdownData,W as mockMultiplierData,Y as mockPriceData,$ as mockSDK,J as mockStatsData,Q as mockVotingData,c as resetI18nState,d as subscribeToWalletState,F as useAsyncAction,V as useCloudSaves,R as useDatafeed,B as useEvents,O as useGasSponsor,q as useGovernance,u as useI18n,G as usePayments,j as useRNG,p as useWallet,e as waitForSDK};
