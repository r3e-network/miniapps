import{b as e,c as n,o as a,p as t,q as i,w as o,t as l,v as s,x as r,a as d,y as c,z as u,A as v,B as f,C as g,j as p,k as w,D as h,E as y,F as m,G as _,H as b}from"./vue-vendor.BD4l_Lyv.js";import{_ as C,u as k,A}from"./Fireworks.vue_vue_type_style_index_0_scoped_b6ed5fc5_lang.DODjSBoU.js";import"./index-BMX3b46_.js";const I=C(e({__name:"NeoButton",props:{variant:{default:"primary"},size:{default:"md"},block:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},loading:{type:Boolean,default:!1}},emits:["click"],setup:e=>(e,r)=>{const d=s,c=t;return a(),n(c,{class:i(["neo-btn",`neo-btn--${e.variant}`,`neo-btn--${e.size}`,{"neo-btn--block":e.block,"neo-btn--loading":e.loading}]),disabled:e.disabled||e.loading,"aria-busy":e.loading,"aria-disabled":e.disabled||e.loading,onClick:r[0]||(r[0]=n=>e.$emit("click",n))},{default:o(()=>[e.loading?(a(),n(d,{key:0,class:"neo-btn__spinner"})):l(e.$slots,"default",{key:1},void 0,!0)]),_:3},8,["class","disabled","aria-busy","aria-disabled"])}}),[["__scopeId","data-v-554bd0de"]]),S=C(e({__name:"NeoCard",props:{title:{default:void 0},variant:{default:"default"},hoverable:{type:Boolean,default:!1},flat:{type:Boolean,default:!1}},emits:["click"],setup:e=>(e,t)=>{const f=c,g=s;return a(),n(g,{class:i(["neo-card",`neo-card--${e.variant}`,{"neo-card--hoverable":e.hoverable,"neo-card--flat":e.flat}]),onClick:t[0]||(t[0]=n=>e.hoverable&&e.$emit("click",n))},{default:o(()=>[e.title||e.$slots.header?(a(),n(g,{key:0,class:"neo-card__header"},{default:o(()=>[e.title?(a(),n(f,{key:0,class:"neo-card__title"},{default:o(()=>[u(v(e.title),1)]),_:1})):r("",!0),l(e.$slots,"header",{},void 0,!0)]),_:3})):r("",!0),d(g,{class:"neo-card__body"},{default:o(()=>[l(e.$slots,"default",{},void 0,!0)]),_:3}),e.$slots.footer?(a(),n(g,{key:1,class:"neo-card__footer"},{default:o(()=>[l(e.$slots,"footer",{},void 0,!0)]),_:3})):r("",!0)]),_:3},8,["class"])}}),[["__scopeId","data-v-1379b0b6"]]),T=5e3,E=1e4,M=100,O=["https://neomini.app","https://miniapp.neo.org","https://testnet.miniapp.neo.org"];const P=new class{constructor(){this.dynamicOrigins=new Set,this.baseOrigins=new Set([...O])}getSelfOrigin(){if("undefined"==typeof window)return null;try{const e=new URL(window.location.href);if("null"===e.origin)return null;if("http:"===e.protocol||"https:"===e.protocol)return e.origin}catch{}return null}getReferrerOrigin(){if("undefined"==typeof document||!document.referrer)return null;try{return new URL(document.referrer).origin}catch{return null}}getAllowedOrigins(){const e=new Set(this.baseOrigins);this.dynamicOrigins.forEach(n=>e.add(n));const n=this.getReferrerOrigin();n&&this.baseOrigins.has(n)&&e.add(n);const a=this.getSelfOrigin();if(a&&e.add(a),"undefined"!=typeof window){const n=window.location.hostname;"localhost"!==n&&"127.0.0.1"!==n||e.add(window.location.origin)}return e}isValid(e){return!(!e||"null"===e)&&this.getAllowedOrigins().has(e)}getTargetOrigin(){var e;const n=this.getReferrerOrigin();if(n&&this.baseOrigins.has(n))return n;try{if("undefined"!=typeof window&&window.parent!==window&&(null==(e=window.location.ancestorOrigins)?void 0:e.length)>0){const e=window.location.ancestorOrigins[0];if(this.baseOrigins.has(e))return e}}catch{}const a=this.getSelfOrigin();if(a)return a;if("undefined"!=typeof window){const e=window.location.hostname;if("localhost"===e||"127.0.0.1"===e)return window.location.origin}throw new Error("Cannot determine safe target origin - no valid origin found")}getSafeTargetOrigin(){try{const e=this.getTargetOrigin();if(e&&"null"!==e)return e}catch{}if("undefined"!=typeof window&&window.parent!==window){const e=window.__MINIAPP_PARENT_ORIGIN__;if("string"==typeof e&&e&&this.baseOrigins.has(e))return e;throw new Error("Cannot communicate securely with parent - origin unknown. Ensure host app sets __MINIAPP_PARENT_ORIGIN__ or uses a supported browser.")}throw new Error("Cannot determine safe target origin - origin is null or undefined")}addDynamicOrigin(e){e&&"null"!==e&&this.dynamicOrigins.add(e)}};let N=null;function R(e){if(!e||"object"!=typeof e)return!1;const n="function"==typeof e.invoke&&"function"==typeof e.getConfig,a="object"==typeof e.wallet||"object"==typeof e.payments;return n||a}function D(e=T){return new Promise((n,a)=>{if("undefined"==typeof window)return void a(new Error("SDK not available in SSR"));if(window.MiniAppSDK)return R(window.MiniAppSDK)?void n(window.MiniAppSDK):void a(new Error("SDK validation failed"));const t=setTimeout(()=>{if(window.removeEventListener("miniapp-sdk-ready",i),window.parent!==window){const e=function(){const e=P.getSafeTargetOrigin();let n=0;const a=(a,...t)=>new Promise((i,o)=>{const l=`sdk-${++n}-${Date.now()}-${Math.random().toString(36).slice(2,8)}`,s=setTimeout(()=>{window.removeEventListener("message",r),o(new Error("SDK invoke timeout"))},E),r=e=>{var n,a;P.isValid(e.origin)&&e.source===window.parent&&"miniapp_sdk_response"===(null==(n=e.data)?void 0:n.type)&&(null==(a=e.data)?void 0:a.id)===l&&(clearTimeout(s),window.removeEventListener("message",r),e.data.ok?i(e.data.result):o(new Error(e.data.error||"SDK call failed")))};window.addEventListener("message",r),window.parent.postMessage({type:"miniapp_sdk_request",id:l,method:a,params:t},e)});return{invoke:a,getConfig:()=>N||("undefined"!=typeof window&&window.__MINIAPP_CONFIG__?(N=window.__MINIAPP_CONFIG__,N):{appId:"",contractAddress:null,chainId:null,chainType:void 0,supportedChains:[],debug:!1}),getAddress:()=>a("getAddress"),wallet:{getAddress:()=>a("wallet.getAddress"),switchChain:e=>a("wallet.switchChain",e),invokeIntent:e=>a("wallet.invokeIntent",e),signMessage:e=>a("wallet.signMessage",e)},payments:{payGAS:(e,n,t)=>a("payments.payGAS",e,n,t),payGASAndInvoke:(e,n,t)=>a("payments.payGASAndInvoke",e,n,t)},governance:{vote:(e,n,t,i)=>a("governance.vote",e,n,t,i),voteAndInvoke:(e,n,t,i)=>a("governance.voteAndInvoke",e,n,t,i),getCandidates:()=>a("governance.getCandidates")},rng:{requestRandom:e=>a("rng.requestRandom",e)},datafeed:{getPrice:e=>a("datafeed.getPrice",e),getPrices:()=>a("datafeed.getPrices"),getNetworkStats:()=>a("datafeed.getNetworkStats"),getRecentTransactions:e=>a("datafeed.getRecentTransactions",e)},stats:{getMyUsage:(e,n)=>a("stats.getMyUsage",e,n)},events:{list:e=>a("events.list",e),emit:(e,n)=>a("events.emit",e,n)},transactions:{list:e=>a("transactions.list",e)},automation:{register:(e,n,t,i)=>a("automation.register",e,n,t,i),unregister:e=>a("automation.unregister",e),status:e=>a("automation.status",e),list:()=>a("automation.list"),update:(e,n,t)=>a("automation.update",e,n,t),enable:e=>a("automation.enable",e),disable:e=>a("automation.disable",e),logs:(e,n)=>a("automation.logs",e,n)},share:{openModal:e=>a("share.openModal",e),getUrl:e=>a("share.getUrl",e),copy:e=>a("share.copy",e)}}}();window.MiniAppSDK=e,e.invoke("getConfig").then(e=>{e&&"object"==typeof e&&(N=e)}).catch(()=>{}),n(e)}else a(new Error("SDK timeout"))},e),i=()=>{if(clearTimeout(t),window.removeEventListener("miniapp-sdk-ready",i),window.MiniAppSDK){if(!R(window.MiniAppSDK))return void a(new Error("SDK validation failed"));n(window.MiniAppSDK)}else a(new Error("SDK not found"))};window.addEventListener("miniapp-sdk-ready",i)})}function x(){return"undefined"==typeof window?null:window.MiniAppSDK??null}const $=new Set;let K={connected:!1,address:null,balance:null},j=null,B=!1;async function G(e,n={}){var a;const t=e.startsWith("http")?e:`https://api.neo-service-layer.io${e}`;if("undefined"!=typeof uni&&"function"==typeof f)return new Promise((e,a)=>{const i=(e=>{if(e){if(e instanceof Headers){const n={};return e.forEach((e,a)=>{n[a]=e}),n}return Array.isArray(e)?Object.fromEntries(e):e}})(n.headers),o=String((null==i?void 0:i["Content-Type"])||(null==i?void 0:i["content-type"])||"");let l=n.body;if("string"==typeof l&&o.includes("application/json"))try{l=JSON.parse(l)}catch{}f({url:t,method:n.method||"GET",data:l,header:i,success:n=>{var t,i;if(n.statusCode>=200&&n.statusCode<300)e(n.data);else{const e=(null==(i=null==(t=n.data)?void 0:t.error)?void 0:i.message)||`Request failed: ${n.statusCode}`;a(new Error(e))}},fail:e=>{a(new Error(e.errMsg||"Network error"))}})});const i=await fetch(t,{credentials:"include",...n});if(!i.ok){const n=await i.json().catch(()=>({}));throw new Error((null==(a=n.error)?void 0:a.message)||`Request failed: ${e}`)}return i.json()}async function L(e){return G(e,{method:"GET"})}function H(){const e=g(null),n=g({}),a=g(null),t=g(null),i=g(null),o=g([]),l=g(!1),s=g(!1),r=g(null),d=g(!1),c=g(null),u=i=>{i.connected&&i.address?(e.value=i.address,l.value=!0):(e.value=null,l.value=!1),a.value=i.chainId??null,t.value=i.chainType??null,n.value=(e=>{if(!e)return{};if(e.balances&&Object.keys(e.balances).length>0)return{...e.balances};if(e.balance){const n={};return n[e.balance.nativeSymbol||("neo-n3"===e.chainType?"GAS":"NATIVE")]=e.balance.native||"0",(e.balance.governance||e.balance.governanceSymbol)&&(n[e.balance.governanceSymbol||("neo-n3"===e.chainType?"NEO":"GOV")]=e.balance.governance||"0"),n}return{}})(i)},v=e=>{e&&(i.value=e.chainId??null,o.value=Array.isArray(e.supportedChains)?e.supportedChains:[])},f=async()=>{var e;const n=await D(),a=null==(e=n.getConfig)?void 0:e.call(n);return v(a),a},h=async e=>{const n=await D();if(!n.wallet.switchChain)throw new Error("switchChain not supported by SDK");await n.wallet.switchChain(e),a.value=e};let y=null;return p(()=>{var n;u(K),n=e=>{u(e)},$.add(n),n(K),y=()=>$.delete(n);const i=x();if((null==i?void 0:i.getConfig)&&v(i.getConfig()),i&&!l.value){const n=l.value;i.wallet.getAddress().then(o=>{var s;if(!n&&!l.value){e.value=o,l.value=!0;const n=null==(s=i.getConfig)?void 0:s.call(i);a.value=(null==n?void 0:n.chainId)??null,t.value=(null==n?void 0:n.chainType)??null,v(n)}}).catch(e=>{console.debug("[MiniApp SDK] Fallback wallet connection failed:",(null==e?void 0:e.message)||e)})}D().then(e=>{var n;return v(null==(n=e.getConfig)?void 0:n.call(e))}).catch(()=>{})}),w(()=>{y&&y()}),{address:e,chainId:a,chainType:t,appChainId:i,supportedChains:o,balances:n,isConnected:l,isLoading:s,error:r,showConnectionPrompt:d,connectionPromptMessage:c,connect:async()=>{var n;s.value=!0,r.value=null;try{const i=await D();e.value=await i.wallet.getAddress(),l.value=!0;const o=null==(n=i.getConfig)?void 0:n.call(i);a.value=(null==o?void 0:o.chainId)??null,t.value=(null==o?void 0:o.chainType)??null,v(o)}catch(i){r.value=i}finally{s.value=!1}},invokeIntent:async e=>{var n;const a=x();if(!(null==(n=null==a?void 0:a.wallet)?void 0:n.invokeIntent))throw new Error("invokeIntent not available");return a.wallet.invokeIntent(e)},invokeContract:async e=>{var n;const a=await D(),t=null==(n=a.getConfig)?void 0:n.call(a),i=e.contractAddress||e.scriptHash||e.contractHash,o=e.method||e.operation;if(!i||!o)throw new Error("contract address and method required");return a.invoke("invokeFunction",{contract:i,method:o,args:e.args,chainId:null==t?void 0:t.chainId,chainType:null==t?void 0:t.chainType})},invokeRead:async e=>{var n;const a=await D(),t=null==(n=a.getConfig)?void 0:n.call(a),i=e.contractAddress||e.scriptHash||e.contractHash||(null==t?void 0:t.contractAddress),o=e.method||e.operation;if(!i)throw new Error("contract address not configured");if(!o)throw new Error("method required");return a.invoke("invokeRead",{contract:i,method:o,args:e.args||[],chainId:e.chainId||(null==t?void 0:t.chainId),chainType:e.chainType||(null==t?void 0:t.chainType)})},getContractAddress:async()=>{var e,n,a,t,i;const o=await D(),l=null==(e=o.getConfig)?void 0:e.call(o);if(null==l?void 0:l.contractAddress)return l.contractAddress;if((null==l?void 0:l.chainId)&&(null==(a=null==(n=null==l?void 0:l.chainContracts)?void 0:n[l.chainId])?void 0:a.address))return l.chainContracts[l.chainId].address||null;if(o.invoke)try{const e=await o.invoke("getConfig");if(null==e?void 0:e.contractAddress)return e.contractAddress;if((null==e?void 0:e.chainId)&&(null==(i=null==(t=null==e?void 0:e.chainContracts)?void 0:t[e.chainId])?void 0:i.address))return e.chainContracts[e.chainId].address||null}catch{}return null},getAppConfig:f,getAddress:async()=>(await D()).wallet.getAddress(),signMessage:async e=>{var n;const a=await D();if(!(null==(n=a.wallet)?void 0:n.signMessage))throw new Error("signMessage not available");return a.wallet.signMessage(e)},switchChain:h,switchToAppChain:async e=>{const n=await f(),a=(null==n?void 0:n.chainId)||(Array.isArray(null==n?void 0:n.supportedChains)&&n.supportedChains.length>0?n.supportedChains[0]:null)||e||null;if(!a)throw new Error("app chain not configured");await h(a)},getBalance:async e=>{var t;s.value=!0,r.value=null;try{const i=await D(),o=null==(t=i.getConfig)?void 0:t.call(i),l=(null==o?void 0:o.chainId)||a.value,s=l?`?chain_id=${encodeURIComponent(l)}`:"",r=await L(`/wallet-balance${s}`),d=(null==r?void 0:r.balances)??{};return n.value=d,e?d[e]||"0":d}catch(i){throw r.value=i,i}finally{s.value=!1}},getTransactions:async(e=20)=>{var n;s.value=!0,r.value=null;try{const t=Number.isNaN(e)||e<1?20:Math.min(e,100),i=await D(),o=null==(n=i.getConfig)?void 0:n.call(i),l=(null==o?void 0:o.chainId)||a.value,s=new URLSearchParams({limit:String(t)});l&&s.set("chain_id",l);return(await L(`/wallet-transactions?${s.toString()}`)).transactions}catch(t){throw r.value=t,t}finally{s.value=!1}},invoke:async(e,n)=>(await D()).invoke(e,n),requireConnection:(e={})=>{const{showPrompt:n=!0,errorMessage:a}=e;return!!l.value||(n&&(c.value=a||null,d.value=!0),!1)},closeConnectionPrompt:()=>{d.value=!1,c.value=null},clearError:()=>{r.value=null}}}function U(e,n,a,t){if(!function(e){return"evm"===function(e){if("string"==typeof e)return e;const n=null==e?void 0:e.value;return"string"==typeof n?n:""}(e)}(e))return!0;let i="";if(!i&&"function"==typeof n){const e=n("wrongChainMessage");i=e&&"wrongChainMessage"!==e?e:n("wrongChain")}i||(i="Wrong network");const o=globalThis.uni;return(null==o?void 0:o.showToast)&&o.showToast({title:i,icon:"none"}),!1}"undefined"!=typeof window&&("undefined"!=typeof window&&(B&&j||(j=e=>{if(e.source!==window.parent)return;if(!P.isValid(e.origin))return;const n=e.data;n&&"object"==typeof n&&("miniapp_config"!==n.type?"miniapp_wallet_state_change"===n.type&&(K={connected:Boolean(n.connected),address:n.address||null,chainId:n.chainId??null,chainType:n.chainType??null,balance:n.balance||n.multiChainBalance||null,balances:n.balances||void 0},$.forEach(e=>{try{e(K)}catch(n){console.error("[MiniApp SDK] Wallet state listener error:",n)}})):n.config&&"object"==typeof n.config&&(N=n.config))},window.addEventListener("message",j),B=!0)),setTimeout(function(){if("undefined"==typeof window)return;const e=P.getSafeTargetOrigin();try{window.parent.postMessage({type:"miniapp_ready"},e)}catch{}},M)),g("en");const q=C(e({__name:"index",setup(e){const{t:t}=k(),i=g(""),l=g(""),f=g(""),p=g(!1),w=g(!1),C=g("home"),{address:T,connect:E,signMessage:M,invokeContract:O,chainType:P,switchToAppChain:N}=H(),R=e=>{"docs"===e?b({url:"/pages/docs/index"}):C.value=e},D=async()=>{if(i.value&&U(P,t)){p.value=!0,l.value="",f.value="";try{if(T.value||await E(),!T.value)throw new Error(t("connectWallet"));const e=await M(i.value);"string"==typeof e?l.value=e:e&&"object"==typeof e&&e.signature?l.value=e.signature:l.value=JSON.stringify(e)}catch(e){m({title:e.message||t("signFailed"),icon:"none"})}finally{p.value=!1}}},x=async()=>{if(i.value&&U(P,t))if(e=i.value,("undefined"!=typeof TextEncoder?(new TextEncoder).encode(e).length:encodeURIComponent(e).replace(/%[0-9A-F]{2}/g,"x").length)>1024)m({title:t("messageTooLong"),icon:"none"});else{var e;w.value=!0,f.value="",l.value="";try{if(T.value||await E(),!T.value)throw new Error(t("connectWallet"));const e=await O({scriptHash:"0xd2a4cff31913016155e38e474a2c06d08be276cf",operation:"transfer",args:[{type:"Hash160",value:T.value},{type:"Hash160",value:T.value},{type:"Integer",value:"0"},{type:"String",value:i.value}]});e&&e.txid?f.value=e.txid:f.value="string"==typeof e?e:t("txPending")}catch(n){m({title:n.message||t("broadcastFailed"),icon:"none"})}finally{w.value=!1}}},$=e=>{_({data:e,success:()=>{m({title:t("copySuccess"),icon:"none"})}})};return(e,g)=>{const m=c,_=s,b=y;return a(),n(h(A),{class:"theme-neo-sign-anything",title:h(t)("appTitle"),"show-top-nav":!1,"active-tab":C.value,tabs:[{id:"home",label:h(t)("home"),icon:"Home"},{id:"docs",label:h(t)("docs"),icon:"Book"}],onTabChange:R},{default:o(()=>[d(_,{class:"container"},{default:o(()=>["evm"===h(P)?(a(),n(_,{key:0,class:"chain-warning"},{default:o(()=>[d(h(S),{variant:"danger"},{default:o(()=>[d(_,{class:"chain-warning__content"},{default:o(()=>[d(m,{class:"chain-warning__title"},{default:o(()=>[u(v(h(t)("wrongChain")),1)]),_:1}),d(m,{class:"chain-warning__desc"},{default:o(()=>[u(v(h(t)("wrongChainMessage")),1)]),_:1}),d(h(I),{size:"sm",variant:"secondary",class:"mt-2",onClick:g[0]||(g[0]=()=>h(N)())},{default:o(()=>[u(v(h(t)("switchToNeo")),1)]),_:1})]),_:1})]),_:1})]),_:1})):r("",!0),d(_,{class:"header"},{default:o(()=>[d(m,{class:"title"},{default:o(()=>[u(v(h(t)("signTitle")),1)]),_:1}),d(m,{class:"subtitle"},{default:o(()=>[u(v(h(t)("signDesc")),1)]),_:1})]),_:1}),d(h(S),{variant:"erobo"},{default:o(()=>[d(_,{class:"input-group"},{default:o(()=>[d(m,{class:"label"},{default:o(()=>[u(v(h(t)("messageLabel")),1)]),_:1}),d(b,{modelValue:i.value,"onUpdate:modelValue":g[1]||(g[1]=e=>i.value=e),class:"textarea",placeholder:h(t)("messagePlaceholder"),maxlength:"1000"},null,8,["modelValue","placeholder"]),d(_,{class:"char-count"},{default:o(()=>[u(v(i.value.length)+"/1000",1)]),_:1})]),_:1}),d(_,{class:"actions"},{default:o(()=>[d(h(I),{variant:"primary",block:"",loading:p.value,onClick:D,disabled:!i.value||!h(T)},{default:o(()=>[u(v(h(t)("signBtn")),1)]),_:1},8,["loading","disabled"]),d(h(I),{variant:"ghost",block:"",loading:w.value,onClick:x,disabled:!i.value||!h(T),style:{"margin-top":"12px"}},{default:o(()=>[u(v(h(t)("broadcastBtn")),1)]),_:1},8,["loading","disabled"])]),_:1})]),_:1}),l.value?(a(),n(_,{key:1,class:"result-card"},{default:o(()=>[d(h(S),{variant:"erobo-neo"},{default:o(()=>[d(_,{class:"result-header"},{default:o(()=>[d(m,{class:"result-title"},{default:o(()=>[u(v(h(t)("signatureResult")),1)]),_:1}),d(_,{class:"copy-btn",onClick:g[2]||(g[2]=e=>$(l.value))},{default:o(()=>[d(m,{class:"copy-text"},{default:o(()=>[u(v(h(t)("copy")),1)]),_:1})]),_:1})]),_:1}),d(m,{class:"result-text"},{default:o(()=>[u(v(l.value),1)]),_:1})]),_:1})]),_:1})):r("",!0),f.value?(a(),n(_,{key:2,class:"result-card"},{default:o(()=>[d(h(S),{variant:"erobo-purple"},{default:o(()=>[d(_,{class:"result-header"},{default:o(()=>[d(m,{class:"result-title"},{default:o(()=>[u(v(h(t)("broadcastResult")),1)]),_:1}),d(_,{class:"copy-btn",onClick:g[3]||(g[3]=e=>$(f.value))},{default:o(()=>[d(m,{class:"copy-text"},{default:o(()=>[u(v(h(t)("copy")),1)]),_:1})]),_:1})]),_:1}),d(m,{class:"result-text"},{default:o(()=>[u(v(f.value),1)]),_:1}),d(m,{class:"success-msg"},{default:o(()=>[u(v(h(t)("broadcastSuccess")),1)]),_:1})]),_:1})]),_:1})):r("",!0),h(T)?r("",!0):(a(),n(_,{key:3,class:"connect-prompt"},{default:o(()=>[d(m,{class:"connect-text"},{default:o(()=>[u(v(h(t)("connectWallet")),1)]),_:1})]),_:1}))]),_:1})]),_:1},8,["title","active-tab","tabs"])}}}),[["__scopeId","data-v-4eff6a55"]]);export{q as default};
