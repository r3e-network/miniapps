import{d as e,r as a,p as l,c as s,a as t,w as u,i,b as d,e as c,f as n,q as o,h as r,t as v,u as f,j as _,k as m,F as p,l as h,I as b,s as g,n as y,v as k,g as w,x as C,y as S}from"./index-FfUOk1pn.js";import{u as F,_ as x}from"./Fireworks.vue_vue_type_style_index_0_scoped_b6ed5fc5_lang.CDRSyFuc.js";import{u as A,n as V,i as I,v as U,N,a as T,f as B,c as H,b as L,d as D}from"./multisig.CtaWxO7N.js";const G=x(e({__name:"index",setup(e){const{t:x}=F(),{chainId:G}=A(),O=a(1),P=a(["",""]),j=a(1),K=a("neo-n3-testnet"===G.value?"neo-n3-testnet":"neo-n3-mainnet"),M=a("GAS"),z=a(""),E=a(""),J=a(""),q=a(!1),R=a(!1),$=a(null),Q=a(null),W=a({systemFee:"0",networkFee:"0",validUntilBlock:0});l(P,e=>{j.value>e.length&&(j.value=e.length||1)},{deep:!0});const X=s(()=>{var e;return(null==(e=$.value)?void 0:e.address)||""}),Y=s(()=>{var e;return(null==(e=$.value)?void 0:e.scriptHash)||""}),Z=s(()=>"neo-n3-mainnet"===K.value?x("chainMainnet"):x("chainTestnet")),ee=s(()=>P.value.map(e=>e.trim())),ae=s(()=>{if(ee.value.some(e=>!e))return!1;try{return V(ee.value),!0}catch{return!1}}),le=s(()=>I(z.value)&&U(E.value,M.value)),se=()=>o(),te=()=>P.value.push(""),ue=e=>{K.value=e},ie=e=>{j.value=e.detail.value},de=()=>{O.value=2},ce=()=>{var e;try{const e=V(ee.value);$.value=H(j.value,e),O.value=3}catch(a){const l=(null==(e=null==a?void 0:a.message)?void 0:e.includes("duplicate"))?x("toastDuplicateSigners"):x("toastInvalidSigners");k({title:l,icon:"none"})}},ne=async()=>{if($.value)if(I(z.value))if(U(E.value,M.value)){q.value=!0;try{const e=await L({chainId:K.value,fromAddress:X.value,toAddress:z.value,amount:E.value,assetSymbol:M.value,threshold:j.value,publicKeys:$.value.publicKeys});Q.value=e.tx,W.value={systemFee:e.systemFee,networkFee:e.networkFee,validUntilBlock:e.validUntilBlock},O.value=4}catch(e){k({title:x("toastPrepareFailed"),icon:"none"})}finally{q.value=!1}}else k({title:x("toastInvalidAmount"),icon:"none"});else k({title:x("toastInvalidAddress"),icon:"none"});else k({title:x("toastInvalidSigners"),icon:"none"})},oe=async()=>{if(Q.value&&$.value){R.value=!0;try{const e=await D.create({chainId:K.value,scriptHash:$.value.scriptHash,threshold:j.value,signers:$.value.publicKeys,transactionHex:Q.value.serialize(!1),memo:J.value||void 0}),a=w("multisig_history")?JSON.parse(w("multisig_history")):[];a.unshift({id:e.id,scriptHash:$.value.scriptHash,status:e.status||"pending",createdAt:e.created_at||(new Date).toISOString()}),C("multisig_history",JSON.stringify(a.slice(0,10))),S({url:`/pages/sign/index?id=${e.id}`})}catch(e){k({title:x("toastCreateFailed"),icon:"none"})}finally{R.value=!1}}};return(e,a)=>{const l=n,s=i,o=b,k=g;return d(),t(s,{class:"page-container"},{default:u(()=>[c(s,{class:"nav-header"},{default:u(()=>[c(l,{class:"back-btn",onClick:se},{default:u(()=>[r("←")]),_:1}),c(s,{class:"nav-text"},{default:u(()=>[c(l,{class:"title"},{default:u(()=>[r(v(f(x)("createTitle")),1)]),_:1}),c(l,{class:"subtitle"},{default:u(()=>[r(v(f(x)("appSubtitle")),1)]),_:1})]),_:1})]),_:1}),c(s,{class:"content"},{default:u(()=>[1===O.value?(d(),t(f(N),{key:0,class:"step-card"},{default:u(()=>[c(l,{class:"step-title"},{default:u(()=>[r(v(f(x)("step1Title")),1)]),_:1}),c(l,{class:"step-desc"},{default:u(()=>[r(v(f(x)("step1Desc")),1)]),_:1}),c(s,{class:"signer-list"},{default:u(()=>[(d(!0),m(p,null,h(P.value,(e,a)=>(d(),t(s,{key:a,class:"signer-row"},{default:u(()=>[c(l,{class:"index"},{default:u(()=>[r(v(a+1),1)]),_:2},1024),c(o,{class:"input",modelValue:P.value[a],"onUpdate:modelValue":e=>P.value[a]=e,placeholder:f(x)("signerPlaceholder")},null,8,["modelValue","onUpdate:modelValue","placeholder"]),P.value.length>1?(d(),t(l,{key:0,class:"remove-btn",onClick:e=>{return l=a,P.value.splice(l,1);var l}},{default:u(()=>[r("×")]),_:2},1032,["onClick"])):_("",!0)]),_:2},1024))),128))]),_:1}),c(f(T),{variant:"secondary",size:"sm",onClick:te,class:"add-btn"},{default:u(()=>[r(v(f(x)("addSigner")),1)]),_:1}),c(s,{class:"actions"},{default:u(()=>[c(f(T),{variant:"primary",block:"",onClick:de,disabled:!ae.value},{default:u(()=>[r(v(f(x)("buttonNext")),1)]),_:1},8,["disabled"])]),_:1})]),_:1})):_("",!0),2===O.value?(d(),t(f(N),{key:1,class:"step-card"},{default:u(()=>[c(l,{class:"step-title"},{default:u(()=>[r(v(f(x)("step2Title")),1)]),_:1}),c(l,{class:"step-desc"},{default:u(()=>[r(v(f(x)("step2Desc")),1)]),_:1}),c(s,{class:"threshold-control"},{default:u(()=>[c(l,{class:"threshold-val"},{default:u(()=>[r(v(j.value),1)]),_:1}),c(l,{class:"threshold-total"},{default:u(()=>[r("/ "+v(P.value.length),1)]),_:1})]),_:1}),c(k,{value:j.value,min:1,max:P.value.length,activeColor:"var(--multisig-accent)",onChange:ie},null,8,["value","max"]),c(s,{class:"actions row"},{default:u(()=>[c(f(T),{variant:"secondary",onClick:a[0]||(a[0]=e=>O.value=1)},{default:u(()=>[r(v(f(x)("buttonBack")),1)]),_:1}),c(f(T),{variant:"primary",onClick:ce},{default:u(()=>[r(v(f(x)("buttonNext")),1)]),_:1})]),_:1})]),_:1})):_("",!0),3===O.value?(d(),t(f(N),{key:2,class:"step-card"},{default:u(()=>[c(l,{class:"step-title"},{default:u(()=>[r(v(f(x)("step3Title")),1)]),_:1}),c(l,{class:"step-desc"},{default:u(()=>[r(v(f(x)("step3Desc")),1)]),_:1}),c(s,{class:"summary-block"},{default:u(()=>[c(s,{class:"summary-row"},{default:u(()=>[c(l,{class:"label"},{default:u(()=>[r(v(f(x)("multisigAddressLabel")),1)]),_:1}),c(l,{class:"value mono"},{default:u(()=>[r(v(X.value||"--"),1)]),_:1})]),_:1}),c(s,{class:"summary-row"},{default:u(()=>[c(l,{class:"label"},{default:u(()=>[r(v(f(x)("multisigScriptHashLabel")),1)]),_:1}),c(l,{class:"value mono"},{default:u(()=>[r(v(Y.value||"--"),1)]),_:1})]),_:1})]),_:1}),c(s,{class:"form-group"},{default:u(()=>[c(l,{class:"label"},{default:u(()=>[r(v(f(x)("chainLabel")),1)]),_:1}),c(s,{class:"pill-group"},{default:u(()=>[c(s,{class:y(["pill",{active:"neo-n3-mainnet"===K.value}]),onClick:a[1]||(a[1]=e=>ue("neo-n3-mainnet"))},{default:u(()=>[c(l,null,{default:u(()=>[r(v(f(x)("chainMainnet")),1)]),_:1})]),_:1},8,["class"]),c(s,{class:y(["pill",{active:"neo-n3-testnet"===K.value}]),onClick:a[2]||(a[2]=e=>ue("neo-n3-testnet"))},{default:u(()=>[c(l,null,{default:u(()=>[r(v(f(x)("chainTestnet")),1)]),_:1})]),_:1},8,["class"])]),_:1})]),_:1}),c(s,{class:"form-group"},{default:u(()=>[c(l,{class:"label"},{default:u(()=>[r(v(f(x)("assetLabel")),1)]),_:1}),c(s,{class:"asset-toggle"},{default:u(()=>[c(l,{class:y({active:"GAS"===M.value}),onClick:a[3]||(a[3]=e=>M.value="GAS")},{default:u(()=>[r(v(f(x)("assetGas")),1)]),_:1},8,["class"]),c(l,{class:y({active:"NEO"===M.value}),onClick:a[4]||(a[4]=e=>M.value="NEO")},{default:u(()=>[r(v(f(x)("assetNeo")),1)]),_:1},8,["class"])]),_:1})]),_:1}),c(s,{class:"form-group"},{default:u(()=>[c(l,{class:"label"},{default:u(()=>[r(v(f(x)("toAddressLabel")),1)]),_:1}),c(o,{class:"input",modelValue:z.value,"onUpdate:modelValue":a[5]||(a[5]=e=>z.value=e),placeholder:f(x)("toAddressPlaceholder")},null,8,["modelValue","placeholder"])]),_:1}),c(s,{class:"form-group"},{default:u(()=>[c(l,{class:"label"},{default:u(()=>[r(v(f(x)("amountLabel")),1)]),_:1}),c(o,{class:"input",modelValue:E.value,"onUpdate:modelValue":a[6]||(a[6]=e=>E.value=e),type:"digit",placeholder:f(x)("amountPlaceholder")},null,8,["modelValue","placeholder"])]),_:1}),c(s,{class:"form-group"},{default:u(()=>[c(l,{class:"label"},{default:u(()=>[r(v(f(x)("memoLabel")),1)]),_:1}),c(o,{class:"input",modelValue:J.value,"onUpdate:modelValue":a[7]||(a[7]=e=>J.value=e),placeholder:f(x)("memoPlaceholder")},null,8,["modelValue","placeholder"])]),_:1}),c(s,{class:"actions row"},{default:u(()=>[c(f(T),{variant:"secondary",onClick:a[8]||(a[8]=e=>O.value=2)},{default:u(()=>[r(v(f(x)("buttonBack")),1)]),_:1}),c(f(T),{variant:"primary",onClick:ne,disabled:!le.value||q.value},{default:u(()=>[r(v(q.value?f(x)("loading"):f(x)("buttonReview")),1)]),_:1},8,["disabled"])]),_:1})]),_:1})):_("",!0),4===O.value?(d(),t(f(N),{key:3,class:"step-card"},{default:u(()=>[c(l,{class:"step-title"},{default:u(()=>[r(v(f(x)("step4Title")),1)]),_:1}),c(l,{class:"step-desc"},{default:u(()=>[r(v(f(x)("step4Desc")),1)]),_:1}),c(s,{class:"review-item"},{default:u(()=>[c(l,{class:"label"},{default:u(()=>[r(v(f(x)("reviewFrom")),1)]),_:1}),c(l,{class:"value mono"},{default:u(()=>[r(v(X.value),1)]),_:1})]),_:1}),c(s,{class:"review-item"},{default:u(()=>[c(l,{class:"label"},{default:u(()=>[r(v(f(x)("reviewTo")),1)]),_:1}),c(l,{class:"value mono"},{default:u(()=>[r(v(z.value),1)]),_:1})]),_:1}),c(s,{class:"review-item"},{default:u(()=>[c(l,{class:"label"},{default:u(()=>[r(v(f(x)("reviewAmount")),1)]),_:1}),c(l,{class:"value highlight"},{default:u(()=>[r(v(E.value)+" "+v(M.value),1)]),_:1})]),_:1}),c(s,{class:"review-item"},{default:u(()=>[c(l,{class:"label"},{default:u(()=>[r(v(f(x)("reviewSigners")),1)]),_:1}),c(l,{class:"value"},{default:u(()=>[r(v(j.value)+" / "+v(P.value.length),1)]),_:1})]),_:1}),c(s,{class:"review-item"},{default:u(()=>[c(l,{class:"label"},{default:u(()=>[r(v(f(x)("reviewChain")),1)]),_:1}),c(l,{class:"value"},{default:u(()=>[r(v(Z.value),1)]),_:1})]),_:1}),c(s,{class:"review-item"},{default:u(()=>[c(l,{class:"label"},{default:u(()=>[r(v(f(x)("reviewFees")),1)]),_:1}),c(s,{class:"fee-grid"},{default:u(()=>[c(s,{class:"fee-row"},{default:u(()=>[c(l,{class:"fee-label"},{default:u(()=>[r(v(f(x)("reviewNetworkFee")),1)]),_:1}),c(l,{class:"fee-value"},{default:u(()=>[r(v(f(B)(W.value.networkFee))+" GAS",1)]),_:1})]),_:1}),c(s,{class:"fee-row"},{default:u(()=>[c(l,{class:"fee-label"},{default:u(()=>[r(v(f(x)("reviewSystemFee")),1)]),_:1}),c(l,{class:"fee-value"},{default:u(()=>[r(v(f(B)(W.value.systemFee))+" GAS",1)]),_:1})]),_:1})]),_:1})]),_:1}),c(s,{class:"review-item"},{default:u(()=>[c(l,{class:"label"},{default:u(()=>[r(v(f(x)("reviewValidUntil")),1)]),_:1}),c(l,{class:"value"},{default:u(()=>[r(v(W.value.validUntilBlock),1)]),_:1})]),_:1}),J.value?(d(),t(s,{key:0,class:"review-item"},{default:u(()=>[c(l,{class:"label"},{default:u(()=>[r(v(f(x)("detailMemo")),1)]),_:1}),c(l,{class:"value"},{default:u(()=>[r(v(J.value),1)]),_:1})]),_:1})):_("",!0),c(s,{class:"actions row"},{default:u(()=>[c(f(T),{variant:"secondary",onClick:a[9]||(a[9]=e=>O.value=3)},{default:u(()=>[r(v(f(x)("buttonBack")),1)]),_:1}),c(f(T),{variant:"primary",onClick:oe,disabled:R.value},{default:u(()=>[r(v(R.value?f(x)("buttonCreating"):f(x)("buttonCreate")),1)]),_:1},8,["disabled"])]),_:1})]),_:1})):_("",!0)]),_:1})]),_:1})}}}),[["__scopeId","data-v-e2885919"]]);export{G as default};
