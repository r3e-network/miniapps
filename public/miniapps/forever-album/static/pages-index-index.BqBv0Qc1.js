import{b as e,c as a,o as l,p as t,q as n,w as s,t as o,a as r,v as i,x as u,y as c,z as d,I as p,A as v,B as f,C as y,D as _,E as m,j as g,F as h,G as w,H as b,J as k,K as C,L as A,M as x,N as S,O as T,P,Q as $}from"./vue-vendor.BrwKB4Yk.js";import{A as z,_ as B,u as I,N as E,a as F,b as M,c as U}from"./Fireworks.vue_vue_type_style_index_0_scoped_b6ed5fc5_lang.Ct0OEkli.js";import"./index-DWEuPxnd.js";const V=B(e({__name:"NeoInput",props:{modelValue:{},type:{},label:{},placeholder:{},suffix:{},suffixIcon:{},hint:{},error:{},disabled:{type:Boolean}},emits:["update:modelValue","focus","blur"],setup:e=>(e,f)=>{const y=i,_=d,m=p,g=t;return l(),a(g,{class:n(["neo-input",{"neo-input--error":e.error,"neo-input--disabled":e.disabled}])},{default:s(()=>[e.label?(l(),a(y,{key:0,class:"neo-input__label"},{default:s(()=>[u(c(e.label),1)]),_:1})):o("",!0),r(g,{class:"neo-input__wrapper"},{default:s(()=>["textarea"===e.type?(l(),a(_,{key:0,value:e.modelValue,placeholder:e.placeholder,disabled:e.disabled,class:"neo-input__field neo-input__textarea",onInput:f[0]||(f[0]=a=>e.$emit("update:modelValue",a.detail.value)),onFocus:f[1]||(f[1]=a=>e.$emit("focus",a)),onBlur:f[2]||(f[2]=a=>e.$emit("blur",a))},null,8,["value","placeholder","disabled"])):(l(),a(m,{key:1,value:e.modelValue,type:e.type,placeholder:e.placeholder,disabled:e.disabled,class:"neo-input__field",onInput:f[3]||(f[3]=a=>e.$emit("update:modelValue",a.detail.value)),onFocus:f[4]||(f[4]=a=>e.$emit("focus",a)),onBlur:f[5]||(f[5]=a=>e.$emit("blur",a))},null,8,["value","type","placeholder","disabled"])),e.suffixIcon||e.suffix?(l(),a(g,{key:2,class:"neo-input__suffix"},{default:s(()=>[e.suffixIcon?(l(),a(v(z),{key:0,name:e.suffixIcon,size:18},null,8,["name"])):o("",!0),e.suffix?(l(),a(y,{key:1},{default:s(()=>[u(c(e.suffix),1)]),_:1})):o("",!0)]),_:1})):o("",!0)]),_:1}),e.error?(l(),a(y,{key:1,class:"neo-input__error"},{default:s(()=>[u(c(e.error),1)]),_:1})):e.hint?(l(),a(y,{key:2,class:"neo-input__hint"},{default:s(()=>[u(c(e.hint),1)]),_:1})):o("",!0)]),_:1},8,["class"])}}),[["__scopeId","data-v-a3929104"]]),N=B(e({__name:"NeoModal",props:{visible:{type:Boolean},title:{},variant:{},closeable:{type:Boolean}},emits:["close"],setup:e=>(e,d)=>{const p=i,v=t;return e.visible?(l(),a(v,{key:0,class:"neo-modal",onClick:d[1]||(d[1]=f(a=>e.closeable&&e.$emit("close"),["self"]))},{default:s(()=>[r(v,{class:n(["neo-modal__content",`neo-modal--${e.variant}`])},{default:s(()=>[e.title?(l(),a(v,{key:0,class:"neo-modal__header"},{default:s(()=>[r(p,{class:"neo-modal__title"},{default:s(()=>[u(c(e.title),1)]),_:1}),e.closeable?(l(),a(v,{key:0,class:"neo-modal__close",onClick:d[0]||(d[0]=a=>e.$emit("close"))},{default:s(()=>[r(z,{name:"x",size:20})]),_:1})):o("",!0)]),_:1})):o("",!0),r(v,{class:"neo-modal__body"},{default:s(()=>[y(e.$slots,"default",{},void 0,!0)]),_:3}),e.$slots.footer?(l(),a(v,{key:1,class:"neo-modal__footer"},{default:s(()=>[y(e.$slots,"footer",{},void 0,!0)]),_:3})):o("",!0)]),_:3},8,["class"])]),_:3})):o("",!0)}}),[["__scopeId","data-v-9a03a69a"]]),D=B(e({__name:"WalletPrompt",props:{visible:{type:Boolean},message:{}},emits:["close","connect"],setup(e,{emit:n}){const{t:o}=I(),d=n,p=_(!1),f=async()=>{p.value=!0,d("connect")};return(e,n)=>{const d=i,y=t;return l(),a(N,{visible:e.visible,title:v(o)("wpTitle"),variant:"warning",closeable:!0,onClose:n[1]||(n[1]=a=>e.$emit("close"))},{footer:s(()=>[r(E,{variant:"ghost",size:"sm",onClick:n[0]||(n[0]=a=>e.$emit("close"))},{default:s(()=>[u(c(v(o)("wpCancel")),1)]),_:1})]),default:s(()=>[r(y,{class:"wallet-prompt"},{default:s(()=>[r(d,{class:"wallet-prompt__desc"},{default:s(()=>[u(c(e.message||v(o)("wpDescription")),1)]),_:1}),r(E,{variant:"primary",size:"lg",class:"wallet-prompt__btn",loading:p.value,onClick:f},{default:s(()=>[r(z,{name:"wallet",size:18}),u(" "+c(v(o)("wpConnect")),1)]),_:1},8,["loading"])]),_:1})]),_:1},8,["visible","title"])}}}),[["__scopeId","data-v-00037a3d"]]);function H(e){try{const a=function(e){const a=e.replace(/^0x/i,"").trim();if(!a)return new Uint8Array;const l=a.length%2==0?a:`0${a}`,t=new Uint8Array(l.length/2);for(let n=0;n<t.length;n+=1)t[n]=Number.parseInt(l.slice(2*n,2*n+2),16);return t}(e);if(!a.length)return"";const l=new TextDecoder("utf-8",{fatal:!1}).decode(a);return l.includes("�")?null:l}catch{return null}}function K(e){if(!e||"object"!=typeof e)return e;const a=e,l=String(a.type||a.Type||""),t=a.value??a.Value;switch(l){case"Integer":return t??"0";case"Boolean":return!0===t||"true"===t||1===t||"1"===t;case"ByteArray":case"ByteString":{const e=String(t??"").replace(/^0x/i,""),a=H(e);return null!==a?a:e}case"String":return String(t??"");case"Hash160":case"Hash256":return function(e){const a=String(e||"").trim();return a?a.replace(/^0x/i,"").toLowerCase():""}(String(t??""));case"Array":case"Struct":return Array.isArray(t)?t.map(K):[];case"Map":if(Array.isArray(t)){const e={};for(const a of t){const l=K(null==a?void 0:a.key),t=K(null==a?void 0:a.value);e[String(l)]=t}return e}return{};default:return t}}function L(e){var a,l;if(!e)return null;if(Array.isArray(e))return e.map(K);const t=e,n=t.stack||(null==(a=t.result)?void 0:a.stack)||t.state||(null==(l=t.result)?void 0:l.state)||t.value||null;if(Array.isArray(n)){const e=n.map(K);return 1===e.length?e[0]:e}return t.type?K(e):e}const j=6e4,G=B(e({__name:"index",setup(e){const{t:n}=I(),{address:d,connect:p,invokeRead:y,invokeContract:z,chainType:B,getContractAddress:H,switchToAppChain:K}=F(),G=_("album"),R=m(()=>[{id:"album",icon:"archive",label:n("albumTab")},{id:"docs",icon:"book",label:n("docsTab")}]),W=e=>{"docs"===e?$({url:"/pages/docs/index"}):G.value=e},q=_(null),J=_(!1),O=_([]),Q=_(!1),X=_([]),Y=_(!1),Z=_(""),ee=_(!1),ae=_(!1),le=_(null),te=_(""),ne=_(!1),se=_(""),oe=_(!1),re=m(()=>X.value.reduce((e,a)=>e+a.size,0)),ie=()=>{oe.value=!0},ue=()=>{oe.value=!1},ce=async()=>{try{await p(),oe.value=!1}catch{oe.value=!1}},de=async()=>{if(!function(e,a){if(!function(e){return"evm"===function(e){if("string"==typeof e)return e;const a=null==e?void 0:e.value;return"string"==typeof a?a:""}(e)}(e))return!0;let l="";if(!l&&"function"==typeof a){const e=a("wrongChainMessage");l=e&&"wrongChainMessage"!==e?e:a("wrongChain")}l||(l="Wrong network");const t=globalThis.uni;return(null==t?void 0:t.showToast)&&t.showToast({title:l,icon:"none"}),!1}(B,n))throw new Error(n("wrongChain"));if(q.value||(q.value=await H()),!q.value)throw new Error(n("missingContract"));return q.value},pe=async()=>{if(d.value){J.value=!0;try{const e=await de(),a=await y({contractAddress:e,operation:"getUserPhotoCount",args:[{type:"Hash160",value:d.value}]}),l=Number(L(a)||0);if(!l)return void(O.value=[]);const t=Math.min(l,50),n=L(await y({contractAddress:e,operation:"getUserPhotoIds",args:[{type:"Hash160",value:d.value},{type:"Integer",value:"0"},{type:"Integer",value:String(t)}]})),s=Array.isArray(n)?n.map(e=>String(e)).filter(Boolean):[],o=await Promise.all(s.map(async a=>(e=>{if(!Array.isArray(e)||e.length<5)return null;const[a,l,t,n,s]=e;return a&&n?{id:String(a),data:String(n),encrypted:Boolean(t),createdAt:Number(s||0)}:null})(L(await y({contractAddress:e,operation:"getPhoto",args:[{type:"ByteArray",value:a}]})))));O.value=o.filter(e=>!!e).sort((e,a)=>a.createdAt-e.createdAt)}catch(e){w({title:(null==e?void 0:e.message)||n("loadFailed"),icon:"none"})}finally{J.value=!1}}else O.value=[]},ve=async()=>{d.value?(Q.value=!0,X.value=[],Y.value=!1,Z.value=""):ie()},fe=()=>{Q.value=!1},ye=()=>{const e=5-X.value.length;e<=0?w({title:n("maxPhotosReached"),icon:"none"}):S({count:e,sizeType:["compressed"],sourceType:["album","camera"],success:async e=>{const a=e.tempFilePaths||[];for(const l of a){const e=await _e(l),a=e.length;if(a>45e3){w({title:n("imageTooLarge"),icon:"none"});continue}if(re.value+a>j){w({title:n("totalTooLarge"),icon:"none"});break}X.value.push({id:`${Date.now()}-${Math.random().toString(16).slice(2)}`,dataUrl:e,size:a})}}})},_e=e=>new Promise((a,l)=>{T({src:e,success:t=>{const n=me(null==t?void 0:t.type,e);uni.getFileSystemManager().readFile({filePath:e,encoding:"base64",success:e=>{a(`data:${n};base64,${e.data}`)},fail:l})},fail:l})}),me=(e,a)=>{const l=(e||a.split(".").pop()||"").toLowerCase();return"png"===l?"image/png":"gif"===l?"image/gif":"webp"===l?"image/webp":"image/jpeg"},ge=e=>e<1024?`${e}B`:`${(e/1024).toFixed(1)}KB`,he=()=>{var e;if("undefined"==typeof window||!(null==(e=window.crypto)?void 0:e.subtle))throw new Error(n("cryptoUnavailable"))},we=e=>{let a="";return e.forEach(e=>{a+=String.fromCharCode(e)}),btoa(a)},be=e=>{const a=atob(e),l=new Uint8Array(a.length);for(let t=0;t<a.length;t+=1)l[t]=a.charCodeAt(t);return l},ke=async(e,a)=>{he();const l=new TextEncoder,t=await window.crypto.subtle.importKey("raw",l.encode(e),"PBKDF2",!1,["deriveKey"]);return window.crypto.subtle.deriveKey({name:"PBKDF2",salt:a,iterations:1e5,hash:"SHA-256"},t,{name:"AES-GCM",length:256},!1,["encrypt","decrypt"])},Ce=async(e,a)=>{he();const l=new TextEncoder,t=window.crypto.getRandomValues(new Uint8Array(16)),n=window.crypto.getRandomValues(new Uint8Array(12)),s=await ke(a,t),o=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:n},s,l.encode(e));return JSON.stringify({v:1,alg:"AES-GCM",salt:we(t),iv:we(n),data:we(new Uint8Array(o))})},Ae=async()=>{if(!ee.value&&0!==X.value.length)if(d.value)if(!Y.value||Z.value){ee.value=!0;try{const e=await de(),a=[];let l=0;for(const t of X.value){const e=Y.value?await Ce(t.dataUrl,Z.value):t.dataUrl;if(e.length>45e3)throw new Error(n("encryptedTooLarge"));if(l+=e.length,l>j)throw new Error(n("totalTooLarge"));a.push(e)}await z({contractAddress:e,operation:"uploadPhotos",args:[{type:"Array",value:a.map(e=>({type:"String",value:e}))},{type:"Array",value:a.map(()=>({type:"Boolean",value:Y.value}))}]}),w({title:n("uploadSuccess"),icon:"success"}),fe(),X.value=[],await pe()}catch(e){w({title:(null==e?void 0:e.message)||n("uploadFailed"),icon:"none"})}finally{ee.value=!1}}else w({title:n("passwordRequired"),icon:"none"});else ie()},xe=()=>{ae.value=!1,le.value=null,se.value="",te.value=""},Se=async()=>{if(le.value)if(te.value){ne.value=!0;try{const e=await(async(e,a)=>{he();const l=JSON.parse(e);if(!l||1!==l.v||"AES-GCM"!==l.alg)throw new Error(n("invalidPayload"));const t=be(l.salt||""),s=be(l.iv||""),o=be(l.data||""),r=await ke(a,t),i=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:s},r,o);return(new TextDecoder).decode(i)})(le.value.data,te.value);if(!e.startsWith("data:image"))throw new Error(n("invalidPayload"));se.value=e}catch(e){w({title:(null==e?void 0:e.message)||n("decryptFailed"),icon:"none"})}finally{ne.value=!1}}else w({title:n("passwordRequired"),icon:"none"})},Te=()=>{se.value&&P({urls:[se.value]})};return g(()=>{d.value&&pe()}),h(d,()=>{pe()}),(e,p)=>{const y=i,_=t,m=A,g=x;return l(),a(v(U),{class:"theme-forever-album",tabs:R.value,"active-tab":G.value,onTabChange:W},{default:s(()=>[r(_,{class:"album-container"},{default:s(()=>["evm"===v(B)?(l(),a(_,{key:0,class:"chain-warning"},{default:s(()=>[r(v(M),{variant:"danger"},{default:s(()=>[r(_,{class:"chain-warning__content"},{default:s(()=>[r(y,{class:"chain-warning__title"},{default:s(()=>[u(c(v(n)("wrongChain")),1)]),_:1}),r(y,{class:"chain-warning__desc"},{default:s(()=>[u(c(v(n)("wrongChainMessage")),1)]),_:1}),r(v(E),{size:"sm",variant:"secondary",class:"mt-2",onClick:p[0]||(p[0]=()=>v(K)())},{default:s(()=>[u(c(v(n)("switchToNeo")),1)]),_:1})]),_:1})]),_:1})]),_:1})):o("",!0),r(_,{class:"header"},{default:s(()=>[r(y,{class:"title"},{default:s(()=>[u(c(v(n)("title")),1)]),_:1}),r(y,{class:"subtitle"},{default:s(()=>[u(c(v(n)("subtitle")),1)]),_:1})]),_:1}),v(d)?o("",!0):(l(),a(v(M),{key:1,variant:"warning",class:"connect-card"},{default:s(()=>[r(_,{class:"connect-card__content"},{default:s(()=>[r(y,{class:"connect-card__title"},{default:s(()=>[u(c(v(n)("connectPromptTitle")),1)]),_:1}),r(y,{class:"connect-card__desc"},{default:s(()=>[u(c(v(n)("connectPromptDesc")),1)]),_:1}),r(v(E),{size:"sm",variant:"primary",onClick:ie},{default:s(()=>[u(c(v(n)("connectWallet")),1)]),_:1})]),_:1})]),_:1})),r(v(M),{variant:"erobo",class:"gallery-card"},{default:s(()=>[J.value?(l(),a(_,{key:0,class:"loading-state"},{default:s(()=>[r(y,null,{default:s(()=>[u(c(v(n)("loading")),1)]),_:1})]),_:1})):(l(),a(_,{key:1,class:"gallery-grid"},{default:s(()=>[(l(!0),b(k,null,C(O.value,e=>(l(),a(_,{key:e.id,class:"photo-item",onClick:a=>(e=>{if(e.encrypted)return le.value=e,te.value="",se.value="",void(ae.value=!0);P({urls:[e.data]})})(e)},{default:s(()=>[e.encrypted?(l(),a(_,{key:1,class:"photo-locked"},{default:s(()=>[r(y,{class:"lock-label"},{default:s(()=>[u(c(v(n)("encrypted")),1)]),_:1})]),_:1})):(l(),a(m,{key:0,src:e.data,mode:"aspectFill",class:"photo-img"},null,8,["src"])),e.encrypted?(l(),a(_,{key:2,class:"lock-icon"},{default:s(()=>[u(c(v(n)("encrypted")),1)]),_:1})):o("",!0)]),_:2},1032,["onClick"]))),128)),r(_,{class:"photo-item placeholder",onClick:ve},{default:s(()=>[r(y,{class:"plus-icon"},{default:s(()=>[u("+")]),_:1}),r(y,{class:"add-label"},{default:s(()=>[u(c(v(n)("addPhoto")),1)]),_:1})]),_:1})]),_:1})),J.value||0!==O.value.length?o("",!0):(l(),a(_,{key:2,class:"empty-state"},{default:s(()=>[r(y,{class:"empty-title"},{default:s(()=>[u(c(v(n)("emptyTitle")),1)]),_:1}),r(y,{class:"empty-desc"},{default:s(()=>[u(c(v(n)("emptyDesc")),1)]),_:1})]),_:1}))]),_:1}),r(_,{class:"helper-note"},{default:s(()=>[r(y,null,{default:s(()=>[u(c(v(n)("tapToSelect")),1)]),_:1})]),_:1})]),_:1}),r(v(N),{visible:Q.value,title:v(n)("uploadPhoto"),closeable:"",onClose:fe},{footer:s(()=>[r(v(E),{variant:"ghost",size:"sm",onClick:fe},{default:s(()=>[u(c(v(n)("cancel")),1)]),_:1}),r(v(E),{variant:"primary",size:"sm",disabled:0===X.value.length||ee.value,loading:ee.value,onClick:Ae},{default:s(()=>[u(c(ee.value?v(n)("uploading"):v(n)("confirm")),1)]),_:1},8,["disabled","loading"])]),default:s(()=>[r(_,{class:"upload-body"},{default:s(()=>[r(_,{class:"upload-grid"},{default:s(()=>[(l(!0),b(k,null,C(X.value,e=>(l(),a(_,{key:e.id,class:"upload-item"},{default:s(()=>[r(m,{src:e.dataUrl,mode:"aspectFill",class:"upload-img"},null,8,["src"]),r(_,{class:"remove-btn",onClick:f(a=>{return l=e.id,void(X.value=X.value.filter(e=>e.id!==l));var l},["stop"])},{default:s(()=>[u("×")]),_:2},1032,["onClick"])]),_:2},1024))),128)),X.value.length<5?(l(),a(_,{key:0,class:"upload-item upload-placeholder",onClick:ye},{default:s(()=>[r(y,{class:"upload-plus"},{default:s(()=>[u("+")]),_:1}),r(y,{class:"upload-tip"},{default:s(()=>[u(c(v(n)("selectMore")),1)]),_:1})]),_:1})):o("",!0)]),_:1}),r(_,{class:"upload-meta"},{default:s(()=>[r(y,null,{default:s(()=>[u(c(v(n)("uploadHint",{count:X.value.length,max:5})),1)]),_:1}),r(y,{class:"upload-meta__size"},{default:s(()=>[u(c(v(n)("sizeHint",{size:ge(re.value),max:ge(j)})),1)]),_:1})]),_:1}),r(_,{class:"form-group"},{default:s(()=>[r(y,{class:"label"},{default:s(()=>[u(c(v(n)("encryptPhoto")),1)]),_:1}),r(g,{checked:Y.value,onChange:p[1]||(p[1]=e=>Y.value=e.detail.value)},null,8,["checked"])]),_:1}),Y.value?(l(),a(_,{key:0,class:"form-group column"},{default:s(()=>[r(v(V),{modelValue:Z.value,"onUpdate:modelValue":p[2]||(p[2]=e=>Z.value=e),type:"password",placeholder:v(n)("enterPassword")},null,8,["modelValue","placeholder"]),r(y,{class:"hint"},{default:s(()=>[u(c(v(n)("encryptionNote")),1)]),_:1})]),_:1})):o("",!0)]),_:1})]),_:1},8,["visible","title"]),r(v(N),{visible:ae.value,title:v(n)("decryptTitle"),closeable:"",onClose:xe},{default:s(()=>[r(_,{class:"decrypt-body"},{default:s(()=>[r(v(V),{modelValue:te.value,"onUpdate:modelValue":p[3]||(p[3]=e=>te.value=e),type:"password",placeholder:v(n)("enterPassword")},null,8,["modelValue","placeholder"]),r(v(E),{variant:"secondary",size:"sm",class:"decrypt-btn",loading:ne.value,onClick:Se},{default:s(()=>[u(c(ne.value?v(n)("decrypting"):v(n)("decryptConfirm")),1)]),_:1},8,["loading"]),se.value?(l(),a(_,{key:0,class:"decrypt-preview"},{default:s(()=>[r(m,{src:se.value,mode:"aspectFit",class:"decrypt-img"},null,8,["src"]),r(v(E),{size:"sm",variant:"ghost",onClick:Te},{default:s(()=>[u(c(v(n)("openPreview")),1)]),_:1})]),_:1})):o("",!0)]),_:1})]),_:1},8,["visible","title"]),r(v(D),{visible:oe.value,onClose:ue,onConnect:ce},null,8,["visible"])]),_:1},8,["tabs","active-tab"])}}}),[["__scopeId","data-v-c749b9d4"]]);export{G as default};
